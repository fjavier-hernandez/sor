
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Instalación de Active Directory del módulo de Sistemas Operativos en red realizado por Francisco Javier Hernández Illán.">
      
      
      
        <link rel="canonical" href="https://github.com/fjavier-hernandez/sor/06_AD1/063_AD_Install.html">
      
      
      
      
      <link rel="icon" href="../imagenes/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>Instalación de Active Directory - Sistemas Operativos en Red</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-0CPJP88MBF"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-0CPJP88MBF",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-0CPJP88MBF",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="javi" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#instalacion-de-active-directory" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../index.html" title="Sistemas Operativos en Red" class="md-header__button md-logo" aria-label="Sistemas Operativos en Red" data-md-component="logo">
      
  <img src="../imagenes/SOR_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Sistemas Operativos en Red
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Instalación de Active Directory
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="javi" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Sistemas Operativos en Red" class="md-nav__button md-logo" aria-label="Sistemas Operativos en Red" data-md-component="logo">
      
  <img src="../imagenes/SOR_logo.png" alt="logo">

    </a>
    Sistemas Operativos en Red
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SituacionAprendizaje.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Situación de Aprendizaje
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Evaluacion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evaluación
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    1.- Instalación de Sistemas Operativos en red.
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            1.- Instalación de Sistemas Operativos en red.
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_INTRO_SOR/001_IntroSOR.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.1- Introducción a Sistemas Operativos en Red
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_INTRO_SOR/002_Virtualizaci%C3%B3n.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.2- Virtualización
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_INTRO_SOR/006_Instalacion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.3- Instalación de Sistemas Operativos en Red
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="instalacion-de-active-directory">Instalación de Active Directory<a class="headerlink" href="#instalacion-de-active-directory" title="Permanent link">&para;</a></h1>
<p>A continuación se muestran los pasos para la instalación de <strong>Active Directory</strong>.</p>
<h2 id="creacion-de-un-dominio">Creación de un dominio<a class="headerlink" href="#creacion-de-un-dominio" title="Permanent link">&para;</a></h2>
<p>El primer paso para la creación del Active directory es crear un dominio; en el equipo <strong>Controlador de Dominio</strong>, y debe ser un equipo preparado para aguantar altas cargas de trabajo con una alta disponibilidad, y con un sistema operativo servidor instalado. </p>
<ul>
<li>Para crear un dominio hay que acceder al <strong>Administrador del Servidor</strong> y accedemos a -&gt;  <strong>Agregar Roles y Características</strong>:</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/001.png" width="900"/>
  <figcaption>Creación de un dominio I.</figcaption>
</figure>

<ul>
<li>Aparece el asistente para comenzar con la creación del dominio:</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/002.png" width="900"/>
  <figcaption>Creación de un dominio II.</figcaption>
</figure>

<ul>
<li>Se selecciona una <strong>instalación basada en características y roles</strong>.</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/003.png" width="900"/>
  <figcaption>Creación de un dominio III.</figcaption>
</figure>

<ul>
<li>Una vez seleccionada la <strong>instalación basada en roles</strong>, se selecciona el servidor que será donde vamos a instalar nuestro <strong>Active Directory</strong>:</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/004.png" width="900"/>
  <figcaption>Creación de un dominio IV.</figcaption>
</figure>

<ul>
<li>Se selecciona el rol <strong>Servicios de Dominio de Active Directory</strong>:</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/005.png" width="900"/>
  <figcaption>Creación de un dominio V.</figcaption>
</figure>

<ul>
<li>Aparecerá marcado el rol tal y como muestra la siguiente figura:</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/006.png" width="900"/>
  <figcaption>Creación de un dominio VI.</figcaption>
</figure>

<figure>
  <img src="./imagenes/02/PracticasAD/PR04/007.png" width="900"/>
  <figcaption>Creación de un dominio VII.</figcaption>
</figure>

<ul>
<li>Se procede a realizar la instalación. Cuando se agrega un nuevo rol, podemos hacer clic en la opción de reiniciar en caso de que fuera necesario. En caso que el rol o la característica no fuera necesario un reinicio, no lo haría.</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/008.png" width="900"/>
  <figcaption>Creación de un dominio VIII.</figcaption>
</figure>

<p>Un vez instalado, el asistente muestra que es necesario realizar una configuración. En este caso hay que promover el servidor a un servidor de controlador de dominio. Así que se hace clic en la opción de <strong>promover servidor a controlador de dominio</strong> :</p>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/009.png" width="900"/>
  <figcaption>Creación de un dominio IX.</figcaption>
</figure>

<ul>
<li>
<p>Se ejecuta el asistente, y las primeras pantallas ofrecen información útil para la creación del dominio.</p>
</li>
<li>
<p><strong>Se selecciona Agregar un nuevo bosque</strong>.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title"><strong>Nota</strong></p>
<p>Un conjunto de dominios agrupados lógicamente conforman un árbol de dominios y un conjunto de árboles de dominio agrupados lógicamente conforman un bosque. En este caso se especifica el dominio <strong>sor.com</strong> en lugar de <strong>CEFIRE2019.LOCAL</strong> como indica en la imagen:</p>
</div>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/010.png" width="900"/>
  <figcaption>Agregar un nuevo Bosque.</figcaption>
</figure>

<ul>
<li>A continuación, aparece información sobre el nivel funcional del nuevo bosque. Según el nivel funcional que se establezca, se implementa un directorio activo compatible con versiones anteriores de Windows Server, pero más limitado en cuanto a funciones, o menos compatible con versiones antiguas, pero con mayores funcionalidades. </li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>En nuestro caso, seleccionaremos el mayor nivel funcional (<strong>Windows Server 2016</strong>) ya que todos los controladores del dominio tendrán instalado, al menos, <strong>Windows Server 2016</strong>. También se añade la contraseña para la restauración del dominio, por defecto la misma que la del administrador.</p>
</div>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/011.png" width="900"/>
  <figcaption>Creación de un dominio X.</figcaption>
</figure>

<ul>
<li>La siguiente tarea que llevará a cabo el asistente para la creación del dominio, será preguntar por ciertas opciones adicionales del servidor, como por ejemplo la <strong>configuración del servicio DNS</strong>. Como en nuestro caso no se tiene DNS, dejaremos que el asistente cree una zona de DNS para que nuestro dominio pueda funcionar.</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/012.png" width="900"/>
  <figcaption>Creación de un dominio XI.</figcaption>
</figure>

<ul>
<li>A continuación aparece la ubicación donde se guardará los objetos del <strong>AD</strong>, es decir, <strong>la base de datos</strong>:</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/013.png" width="900"/>
  <figcaption>Creación de un dominio XII.</figcaption>
</figure>

<p>Seguidamente nos muestra las configuraciones que se van a realizar. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Como se puede observar también se puede exportar el script para poder ejecutar los mismos comandos a través de <strong>PowerShell</strong>:</p>
</div>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/014.png" width="900"/>
  <figcaption>Creación de un dominio XIII.</figcaption>
</figure>

<p>En el siguiente paso se muestra un resumen de los <strong>Requisitos previos</strong>:</p>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/015.png" width="900"/>
  <figcaption>Comprobación de requisitos previos.</figcaption>
</figure>

<ul>
<li>Y finalmente se realiza la instalación. La pantalla de inicio de sesión, ahora será diferente, ya que aparece el dominio al que se va a iniciar la sesión del usuario:</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nos aparecerá <strong>SOR</strong> en lugar de <strong>CEFIRE2019</strong></p>
</div>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/016.png" width="900"/>
  <figcaption>Nueva pantalla inicio de sesión con Dominio.</figcaption>
</figure>

<ul>
<li>Una vez instalado, podemos iniciar sesión con el Administrador del dominio. Podemos comprobar que en el panel de Administrador de Servidor aparece nuestro dominio configurado <strong>sor.com</strong> en lugar de <strong>CEFIRE2019.LOCAL</strong></li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/017.png" width="900"/>
  <figcaption>Comprobación Dominio en el Administrador del Servidor.</figcaption>
</figure>

<!-- # Creación de dominio en Server Core

Se podría hacer una instalación sin experiencia de escritorio del Windows Server 2019 esto es una instalación mucho más liviana que permite tener un servidor sin entorno gráfico. A esta versión se le conoce como el nombre de **Server Core**. En este punto vamos a mostrar a realizar una instalación de un dominio en una máquina Server Core.

Para hacer la instalación, debemos seleccionar la opción de instalación sin experiencia de escritorio:

<figure>
  <img src="./imagenes/02/PracticasAD/PR04/018.png" width="900"/>
  <figcaption>Instalación Server Core.</figcaption>
</figure>

## PowerShell para configurar un dominio

Para configurar el dominio con PowerShell vamos a presentar unos scripts que permitirán realizar la configuración tanto de la máquina como del Active
Directory. Para entrar dentro del shell de PowerShell, teclearemos el comando **powershell** en la consola:

<figure>
  <img src="./imagenes/02/PracticasAD/PR04/019.png" width="900"/>
  <figcaption>Entrar al PowerShell en el Server Core.</figcaption>
</figure>


### Configuración inicial

Primero realizaremos la configuración de la máquina, a través del siguiente script. 

`ConfiguracionInicial.ps1`
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">$nombreServer=&quot;SOR&quot;</span>
<span class="linenos" data-linenos="2 "></span><span class="l l-Scalar l-Scalar-Plain">$dirIP=&quot;192.168.5.1X&quot;</span>
<span class="linenos" data-linenos="3 "></span><span class="l l-Scalar l-Scalar-Plain">$redInterna=&quot;Ethernet 2&quot;</span>
<span class="linenos" data-linenos="4 "></span><span class="l l-Scalar l-Scalar-Plain">Rename-Computer -NewName $nombreServer</span>
<span class="linenos" data-linenos="5 "></span><span class="l l-Scalar l-Scalar-Plain">Get-NetAdapter –name $redInterna | Remove-NetIPAddress -Confirm:$false</span>
<span class="linenos" data-linenos="6 "></span><span class="l l-Scalar l-Scalar-Plain">Get-NetAdapter –name $redInterna | New-NetIPAddress –addressfamily IPv4 –ipaddress $dirIP –prefixlength 24 –type unicast</span>
</code></pre></div>

!!! Warming
    Después de la captura se debe reiniciar para aplicar los cambios.

**Donde se Puede observar:**

- El nombre de máquina en la variable `$nombreServer`
- El adaptador de la red interna en $redInterna (Ejemplo en el script) y también la dirección IP de la red interna en `$dirIP`. 
- El comando` _Rename-Computer -NewName $nombreServer` cambia el nombre del servidor. 
- Los comandos: 
    - `_Get-NetAdapter –__name $redInterna | Remove-NetIPAddress -Confirm:$false` 
    - `_Get-NetAdapter –name $redInterna | New-NetIPAddress –addressfamily IPv4 –ipaddress`
    - `$dirIP –prefixlength 24 –type unicast` 
  Nos permiten añadir la dirección IP de nuestra red interna.
- Finalmente con `_Restart-Computer -force` reiniciamos la máquina y tendremos configurado el nombre y el interfaz de la red interna.

### Instalar Controlador de dominio con powershell

Ahora vamos a promover nuestro servidor a controlador de dominio. Esto también lo vamos a realizar a través de powershell
mediante scripts. 

`creaciondominio.ps1`
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">$dominioFQDN = &quot;SORCORE.LOCAL&quot;</span>
<span class="linenos" data-linenos="2 "></span><span class="l l-Scalar l-Scalar-Plain">$dominioNETBIOS = &quot;SORCORE&quot;</span>
<span class="linenos" data-linenos="3 "></span><span class="l l-Scalar l-Scalar-Plain">$adminPass = &quot;SOR.&quot;</span>
<span class="linenos" data-linenos="4 "></span><span class="l l-Scalar l-Scalar-Plain">Install-WindowsFeature AD-Domain-Services,DNS</span>
<span class="linenos" data-linenos="5 "></span><span class="l l-Scalar l-Scalar-Plain">Import-module addsdeployment</span>
<span class="linenos" data-linenos="6 "></span><span class="l l-Scalar l-Scalar-Plain">Install-ADDSForest -DomainName $dominioFQDN -DomainNetBiosName $dominioNETBIOS -SafeModeAdministratorPassword (ConvertTo-SecureString -string $adminPass -AsPlainText -Force) -DomainMode WinThreshold -ForestMode WinThreshold -InstallDNS -Confirm:$false</span>
</code></pre></div>

**Donde se Puede observar:**

- En la variable `_$dominioFQDN_` pondremos nuestro nombre de dominio 
- y en `_$dominioNETBIOS_` el nombre de dominio NETBIOS. 
- El comando `_Install-WindowsFeature AD-Domain-Services,DNS_` instala los roles de AD y también de DNS.
- El comando` _Install-ADDSForest_` realiza la configuración del dominio.

Al ejecutarlo mostraría por pantalla:

<figure>
  <img src="./imagenes/02/PracticasAD/PR04/020.png" width="900"/>
  <figcaption>Creación de dominio en Server Core.</figcaption>
</figure>

Finalmente reiniciamos la máquina y ya tenemos instalado nuestro controlador de dominio en una máquina core con
powershell. Notad que el inicio de sesión ahora ya es es sor.com.
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/021.png" width="900"/>
  <figcaption>Nuevo Inicio Sesión en Server Core.</figcaption>
</figure>

Para comprobar que todo se ha configurado de manera correcta, podemos iniciar sesión y ejecutar el comando **sconfig**. Nos
muestra información relativa al nombre de máquina, dominio y algunas otras opciones:

<figure>
  <img src="./imagenes/02/PracticasAD/PR04/022.png" width="900"/>
  <figcaption>Utilidad de inspección sconfig.</figcaption>
</figure>

### Apagado de la máquina

!!! Note
    Para poder apagar la máquina podemos hacer uso del comando `shutdown /p` o bien a través de la `opción 14` de la utilidad `sconfig`. -->

<h2 id="unir-clientes-al-dominio">Unir clientes al dominio<a class="headerlink" href="#unir-clientes-al-dominio" title="Permanent link">&para;</a></h2>
<h3 id="anadir-maquinas-clientes-al-dominio">Añadir máquinas clientes al dominio<a class="headerlink" href="#anadir-maquinas-clientes-al-dominio" title="Permanent link">&para;</a></h3>
<p>Para incluir en el dominio los equipos que actuarán como cliente hay que configurar las propiedades de Internet de cada una
de las máquinas que vamos a unir al dominio, teniendo en cuenta que:</p>
<div class="admonition note">
<p class="admonition-title"><strong>Nota</strong></p>
<ul>
<li>La dirección del controlador de dominio (que implementa funciones de <strong>DNS</strong>) en este ejemplo es la <strong>192.168.5.1X</strong>, en tu caso será la IP fija de la máquina que le hayas asignado. </li>
<li>Además, en la red que se ha montado <strong>como ejemplo</strong> hay un elemento de interconexión con <strong>IP 192.168.100.1</strong> que implementa las funciones de puerta de enlace y de DNS, por ese motivo se ha incluido como puerta de enlace predeterminada y como DNS secundario, sin embargo estos dos campos no son necesarios si únicamente queremos trabajar en el interior de una única red. 
<!-- Más adelante veremos instalación de un **servicio de DHCP** y el enrutamiento, para que nuestro servidor pueda ofrecer a los clientes de la red interna una dirección de manera dinámica. --></li>
</ul>
</div>
<p>A continuación, en el siguiente ejemplo, se revisa la configuración de la máquina cliente <strong>Windows 10</strong> que se valida en el <strong>dominio Windows Server 2019</strong>:</p>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/023.png" width="900"/>
  <figcaption>Configuración red cliente Windows 10.</figcaption>
</figure>

<div class="admonition warning">
<p class="admonition-title"><strong>Advertencia</strong></p>
<ul>
<li>La figura anterior es un ejemplo de configuración, habrá que adaptar la configuración al rango utilizado en las máquinas virtuales en <strong>Red NAT</strong>.</li>
<li>Además la máquina cliente utilizada es <strong>Windows 11</strong> en lugar de <strong>windows 10</strong>.</li>
</ul>
</div>
<ul>
<li>Se comprueba también que desde la máquina cliente podamos hacer ping a nuestro dominio, esto es al dominio <strong>sor.com</strong>. Para ello abrimos una terminal en la máquina <strong>Windows 10 (Tecla Windows + R y luego cmd)</strong> y se comprueba que el ping al dominio funcione. </li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Es importante que este ping funcione, en caso contrario no se podrá realizar la validación en nuestro dominio</strong>.</p>
</div>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/024.png" width="900"/>
  <figcaption>ping al dominio.</figcaption>
</figure>

<ul>
<li>Y ahora sí, ya se puede unir nuestra máquina al dominio. Para ello, en Windows 10, se selecciona el botón de inicio y con
el botón de la derecha del ratón, se selecciona Sistema:</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/025.png" width="900"/>
  <figcaption>Unir cliente windows 10 a dominio I.</figcaption>
</figure>

<ul>
<li>Se selecciona Conectar a la red del trabajo o colegio y nos aparecerá la siguiente información:</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/026.png" width="900"/>
  <figcaption>Unir cliente windows 10 a dominio II.</figcaption>
</figure>

<ul>
<li>Se presiona "<strong>clic</strong>" en Conectar:</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/027.png" width="900"/>
  <figcaption>Unir cliente windows 10 a dominio III.</figcaption>
</figure>

<ul>
<li>Se selecciona la opción de Unir este dispositivo a un dominio local de Active Directory. Aparecerá una ventana para
introducir el nombre de dominio al que se debe conectar:</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/028.png" width="900"/>
  <figcaption>Unir cliente windows 10 a dominio IV.</figcaption>
</figure>

<p>En este caso, se introduce el nombre de dominio, <strong>sor.com</strong> en lugar de <strong>CEFIRE2019.LOCAL</strong>:</p>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/029.png" width="900"/>
  <figcaption>Unir cliente windows 10 a dominio V.</figcaption>
</figure>

<div class="admonition warning">
<p class="admonition-title"><strong>Advertencia</strong></p>
<p>Para poder realizar la validación, hay que introducir la cuenta del Administrador del dominio y su contraseña, importante que recuerdes esta contraseña.</p>
</div>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/030.png" width="900"/>
  <figcaption>Unir cliente windows 10 a dominio VI.</figcaption>
</figure>

<ul>
<li>Se selecciona que el administrador tenga los privilegios propios de administrador en la máquina cliente, para ello se selecciona <strong>Tipo Cuenta</strong> y se marca la opción de Administrador. Se reinicia la máquina y ya tenemos el cliente Windows 10 validado en el dominio.</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/030.png" width="900"/>
  <figcaption>Unir cliente windows 10 a dominio VI.</figcaption>
</figure>

<ul>
<li>A partir de este momento, ya se puede iniciar sesión con cualquier usuario del dominio.</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/031.png" width="900"/>
  <figcaption>Unir cliente windows 10 a dominio VII.</figcaption>
</figure>

<ul>
<li>También se puede ver en el servidor, desde el panel del <strong>Administrador de Servidor</strong> la máquina. Para ello, desde la máquina Windows Server 2019, se accede al <strong>Administrador de Servidor --&gt; Herramientas --&gt; Usuarios y Equipos de Active Directory</strong>:</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/032.png" width="900"/>
  <figcaption>Unir cliente windows 10 a dominio VIII.</figcaption>
</figure>

<ul>
<li>Se selecciona el dominio <strong>sor.com</strong> y luego Computers. Aparecerá la máquina cliente "NombreMáquina", si se selecciona, con el botón de la derecha del ratón --&gt; propiedades. Aquí se puede ver alguna información relativa a la máquina conectada.</li>
</ul>
<figure>
  <img src="./imagenes/02/PracticasAD/PR04/033.png" width="900"/>
  <figcaption>Unir cliente windows 10 a dominio IX.</figcaption>
</figure>

<!-- ## Errores en la unión

En caso de que haya habido algún error en la unión del equipo cliente al dominio se deben comprobar algunos
aspectos:

- La configuración de la interfaz de red está en modo 'Adaptador puente', no en 'NAT'.
- El equipo cliente y el equipo servidor se hallan en la misma red.
- El nombre del dominio puede resolverse desde el equipo cliente (ping sor.com )
- La dirección del servidor **DNS** está correctamente configurada en el equipo cliente. -->

<h2 id="pt62-instalacion-de-active-directory">PT62. Instalación de Active Directory<a class="headerlink" href="#pt62-instalacion-de-active-directory" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Contribución a los CEs (Criterios de Evaluación)</p>
<p>Estas actividades contribuyen a los criterios de evaluación <strong>CE5, CE7 y CE9</strong> del <strong>RA1</strong> de SOR.</p>
</div>
<div class="admonition abstract">
<p class="admonition-title">Situación de Aprendizaje</p>
<p>Partiendo de la Situación de aprendizaje de <a href="https://fjavier-hernandez.github.io/sor/06_AD1/062_WS_Config.html#pt61-configuracion-windows-server">PT61</a>, y después de la configuración previa del <strong>Windows Server</strong>. </p>
</div>
<div class="admonition question">
<p class="admonition-title">Tarea</p>
<p>Se debe proceder a la instalación del <strong>Active Directory</strong>, realizando las siguientes premisas.</p>
</div>
<ol>
<li>Instalar y promocionar un servidor a controlador de dominio, en el Windows Server.</li>
<li>Unir un equipo cliente al dominio con usuario de administrador.</li>
</ol>







  
  



  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2023-2024 Francisco Javier Hernández Illán - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="mailto:<fj.hernandez@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48H48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0L0 176z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/fjavier-hernandez-illan" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  




  


<h4>Consentimiento de cookie</h4>
<p>Esta página de apuntes utiliza cookies para reconocer las visitas, medir la efectividad de la documentación y averiguar si encuentras aquello que buscas o cómo has llegado a estos apuntes. Con tu consentimiento, me ayudas a mejorar estos materiales.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Aceptar</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Gestionar cookies</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["header.autohide", "toc.integrate", "navigation.indexes", "navigation.top", "navigation.tracking", "toc.follow"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>