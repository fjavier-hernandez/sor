
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/fjavier-hernandez/sor/05_VAGRANT/AyudaASO/065_VagrantIntro.html">
      
      
      
      
      <link rel="icon" href="../../imagenes/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>Despliegue de Sistemas Heterogéneos con Vagrant - Sistemas Operativos en Red</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-0CPJP88MBF"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-0CPJP88MBF",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-0CPJP88MBF",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="javi" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#despliegue-de-sistemas-heterogeneos-con-vagrant" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../../index.html" title="Sistemas Operativos en Red" class="md-header__button md-logo" aria-label="Sistemas Operativos en Red" data-md-component="logo">
      
  <img src="../../imagenes/SOR_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Sistemas Operativos en Red
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Despliegue de Sistemas Heterogéneos con Vagrant
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="javi" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Sistemas Operativos en Red" class="md-nav__button md-logo" aria-label="Sistemas Operativos en Red" data-md-component="logo">
      
  <img src="../../imagenes/SOR_logo.png" alt="logo">

    </a>
    Sistemas Operativos en Red
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SituacionAprendizaje.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Situación de Aprendizaje
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Evaluacion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evaluación
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    1.- Instalación de Sistemas Operativos en red.
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            1.- Instalación de Sistemas Operativos en red.
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_INTRO_SOR/001_IntroSOR.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.1- Introducción a Sistemas Operativos en Red
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_INTRO_SOR/002_Virtualizaci%C3%B3n.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.2- Virtualización
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_INTRO_SOR/006_Instalacion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.3- Instalación de Sistemas Operativos en Red
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="despliegue-de-sistemas-heterogeneos-con-vagrant">Despliegue de Sistemas Heterogéneos con Vagrant<a class="headerlink" href="#despliegue-de-sistemas-heterogeneos-con-vagrant" title="Permanent link">&para;</a></h1>
<h2 id="justificacion">Justificación<a class="headerlink" href="#justificacion" title="Permanent link">&para;</a></h2>
<p>Actualmente el auge del desarrollo de aplicaciones en sistemas virtualizados requiere del despliegue, conectividad y flexibilidad de sistemas heterogéneos en escenarios de desarrollo de trabajo y producción.</p>
<p>Una de las herramientas más utilizadas por los SRE (Site Reliability Engineer) es <strong>Vagrant</strong>, para conseguir el objetivo principal de crear sistemas de software altamente confiables y escalables. <strong>Vagrant</strong> es una herramienta para la creación y configuración de entornos de desarrollo virtualizados que cubre las necesidades comentadas.</p>
<p>Motivado por dicha relevancia a continuación se introduce la herramienta de Devops <strong>Vagrant</strong>.</p>
<figure>
  <img src="./imagenes/068/001P.png"/>
</figure>

<h2 id="introduccion-vagrant">Introducción Vagrant<a class="headerlink" href="#introduccion-vagrant" title="Permanent link">&para;</a></h2>
<h3 id="que-es-vagrant">¿Qué es Vagrant?<a class="headerlink" href="#que-es-vagrant" title="Permanent link">&para;</a></h3>
<ul>
<li>Es una <strong>herramienta</strong> para construir entornos de desarrollo <strong>simples</strong>, con un flujo de trabajo fácil de usar y un enfoque en la <strong>automatización</strong> replicable. Permite crear y destruir los escenarios en repetidas ocasiones sin gran esfuerzo.</li>
<li>Esencialmente, es una capa de software instalada entre una herramienta de virtualización (como <strong>VirtualBox</strong>, <strong>Docker</strong>, <strong>Hyper-V</strong>) y una máquina virtual.</li>
<li>Por lo tanto, es un software para automatizar las operaciones que se realizan con los <strong>hipervisores</strong>:</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Por ejemplo</p>
<ul>
<li>Crear, configurar, parar, suspender y destruir máquinas virtuales.</li>
<li>Gestionar redes.</li>
<li>Compartir espacios de disco entre guest y host.</li>
<li>Manejar distintos tipos de hipervisores.</li>
</ul>
</div>
<ul>
<li>Es un software de código libre disponible bajo una licencia <code>MIT</code>. El código fuente está disponible en <a href="https://github.com/hashicorp/vagrant">Github</a>.</li>
<li>Fue desarrollado originalmente por <strong>Mitchell Hashimoto</strong> en 2010. A partir de Vagrant se creo <strong>Hashicorp</strong> en 2012.</li>
</ul>
<p><a href="https://www.hashicorp.com">HASHICORP</a></p>
<figure>
  <img src="./imagenes/068/002P.png"/>
</figure>

<div class="admonition tip">
<p class="admonition-title">Aplicaciones de Hashicorp</p>
<ul>
<li><strong>Packer</strong> (imágenes de vagrant)</li>
<li><strong>Consul</strong> (descubrimiento de servicios)</li>
<li><strong>Terraform</strong> (aprovisionamiento)</li>
<li><strong>Vault</strong> (seguridad)</li>
<li><strong>Nomad</strong> (despliegue contenedores)</li>
</ul>
</div>
<h3 id="caracteristicas">Características<a class="headerlink" href="#caracteristicas" title="Permanent link">&para;</a></h3>
<ul>
<li>Puede <strong>integrarse con herramientas de gestión de la configuración</strong>, automatizando la provisión de software de la máquina virtual.</li>
<li>Forma parte del conjunto de aplicaciones utilizadas en <strong>"infraestructura como código"</strong>, mediante un fichero de texto que puede formar parte del código fuente del proyecto, por lo que puede subirse al control de versiones y ser compartido por todos los desarrolladores, dicho fichero es denominado <strong>Vagrant file</strong>.</li>
<li>Soluciona problemas de incidencias de desarrollo entre diferentes sistemas.</li>
</ul>
<!-- <figure>
  <img src="./imagenes/068/004P.png" width="350"/>
</figure> -->

<div class="admonition warning">
<p class="admonition-title">Incidencias</p>
<p>El problema de configurar escenarios a mano conlleva un trabajo tedioso y provoca errores, dando lugar al reproche de <strong>En mi máquina funciona.</strong></p>
</div>
<figure>
  <img src="./imagenes/068/005P.png" width="550"/>
</figure>

<div class="admonition abstract">
<p class="admonition-title">Solución</p>
<ul>
<li><strong>Vagrant</strong>: para Distribuir de forma separada imágenes “limpias” de OS y la configuración completa en un fichero de texto que es el que se distribuye por el grupo de trabajo.</li>
<li>Reduce el tiempo de configuración del entorno de desarrollo, aumenta la paridad de <strong>desarrollo/producción</strong> y hace que la excusa de <strong>"funciona en mi máquina"</strong> sea una reliquia del pasado.</li>
<li>A menudo se utiliza en el desarrollo de software p<strong>ara garantizar que todos los miembros del equipo estén construyendo para la misma configuración</strong>. </li>
<li>No solo comparte entornos, sino que también comparte código. Esto permite que el código de un desarrollador trabaje en el sistema de otro, haciendo posible el desarrollo colaborativo y cooperativo.</li>
</ul>
</div>
<h2 id="vagrant-vs-docker">Vagrant vs. Docker<a class="headerlink" href="#vagrant-vs-docker" title="Permanent link">&para;</a></h2>
<ul>
<li><code>Vagrant</code> es una herramienta centrada en proporcionar un flujo de trabajo de entorno de desarrollo coherente en múltiples sistemas operativos, trabajando sobre los <strong>hipervisores</strong>. </li>
<li>Docker es una gestión de contenedores que puede ejecutar software de forma consistente siempre y cuando exista un sistema de contenedorización.</li>
<li>Los contenedores son generalmente más ligeros que las máquinas virtuales, por lo que iniciar y detener los contenedores es extremadamente rápido. Docker utiliza la funcionalidad de contenedorización nativa en macOS, Linux y Windows. </li>
<li>Para entornos de <strong>microservicios pesados</strong>, Docker puede ser atractivo porque puede iniciar fácilmente una sola máquina virtual Docker e iniciar muchos contenedores por encima de eso muy rápidamente. Este es un buen caso de uso para Docker. </li>
<li><code>Vagrant</code> también puede hacer esto con el proveedor de Docker. Un beneficio principal para Vagrant es un flujo de trabajo consistente, pero hay muchos casos en los que un flujo de trabajo de Docker puro tiene sentido.</li>
<li>Tanto Vagrant como Docker tienen una vasta biblioteca de "imágenes" o "boxes" para elegir.</li>
</ul>
<h2 id="instalacion-vagrant">Instalación Vagrant<a class="headerlink" href="#instalacion-vagrant" title="Permanent link">&para;</a></h2>
<p>Para la instalación el mejor consejo es acudir a la documentación oficial, en el siguiente enlace se pueden obtener los comandos de instalación de Vagrant para los diferentes tipos de sistemas operativos:</p>
<p><a href="https://developer.hashicorp.com/vagrant/downloads">INSTALACIÓN VAGRANT</a></p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En este caso se realiza la ejecución de los comandos para la instalación por repositorios en las distribuciones de Ubuntu/debian.</p>
</div>
<ol>
<li>Descarga de las <strong>GPG</strong>: <strong>GNU Privacy Guard</strong> es una herramienta de cifrado y firmas digitales.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>wget<span class="w"> </span>-O-<span class="w"> </span>https://apt.releases.hashicorp.com/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/usr/share/keyrings/hashicorp-archive-keyring.gpg
</code></pre></div>
<ol start="2">
<li>Introducción de la firma en los repositorios: mediante el comando echo se añade la firma digital al <code>sources.list</code></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/hashicorp.list
</code></pre></div>
<ol start="3">
<li>Actualización de repositorios e instalación de Vagrant.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>vagrant
</code></pre></div>
<ol start="4">
<li>Confirmación de la instalación</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>vagrant<span class="w"> </span>-v
</code></pre></div>
<h2 id="configuracion-del-proyecto-vagrant">Configuración del proyecto Vagrant<a class="headerlink" href="#configuracion-del-proyecto-vagrant" title="Permanent link">&para;</a></h2>
<p>Para tener una máquina virtual totalmente utilizable con Ubuntu 18.04 LTS de 64 bits, solo se necesitan los siguientes dos comandos:</p>
<ol>
<li>Empieza por crear un directorio para almacenar tu archivo Vagrant:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>mkdir<span class="w"> </span>vagrant-test
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nb">cd</span><span class="w"> </span>vagrant-test
</code></pre></div>
<ol start="2">
<li>Se inicializa una maquina virtual, Descargando una distribución del <a href="https://app.vagrantup.com/boxes/search">VAGRANT HUB</a>.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>vagrant<span class="w"> </span>init<span class="w"> </span>hashicorp/bionic64
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Este comando descarga una <code>Vagrantbox</code> y genera un <code>vagrantfile</code> en el directorio del proyecto.</p>
</div>
<div class="admonition abstract">
<p class="admonition-title">Vagrantbox</p>
<ul>
<li>La unidad básica en una configuración de Vagrant se llama <code>box</code> o <code>Vagrantbox</code>. Esta es una imagen completa e independiente de un entorno de sistema operativo.</li>
<li>Una <code>Vagrantbox</code> es un clon de una imagen básica del sistema operativo. El uso de un clon acelera el proceso de lanzamiento y aprovisionamiento.</li>
</ul>
</div>
<div class="admonition abstract">
<p class="admonition-title">vagrantfile</p>
<p>Un <code>Vagrantfile</code> es un archivo de Ruby que le indica a Vagrant que cree, dependiendo de cómo se ejecute, nuevas máquinas o <code>Vagrantbox</code>.</p>
</div>
<ol start="3">
<li>Antes de poder continuar con el siguiente paso, asegúrate de que Vagrant haya creado un <code>Vagrantfile</code>.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>ls<span class="w"> </span>-al
</code></pre></div>
<ol start="4">
<li>Se arranca la máquina virtual.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>vagrant<span class="w"> </span>up
</code></pre></div>
<ol start="5">
<li>Se puede acceder por ssh a la máquina virtual.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>vagrant<span class="w"> </span>ssh
</code></pre></div>
<figure>
  <img src="./imagenes/068/001G.gif"/>
  <figcaption>Creación del proyecto de Vagrant, inicialización de MV y comprobación.</figcaption>
</figure>

<!-- <figure>
  <img src="./imagenes/068/003G.gif"/>
  <figcaption>Creación de una MV configurada.</figcaption>
</figure> -->

<h2 id="configuracion-basica">Configuración básica<a class="headerlink" href="#configuracion-basica" title="Permanent link">&para;</a></h2>
<p>Por defecto, Vagrant almacena las VMs ‘boxed’ en la ruta <code>~/.vagrant.d</code>. Estas ‘boxes’ suelen ser ficheros de gran tamaño, y podemos considerarlas como una ‘imagen modelo’ de las MVs que tendremos en ejecución. Se pueden compartir entre diferentes usuarios, con el objetivo de optimizar el espacio utilizado en disco.</p>
<p>La ubicación del directorio principal de Vagrant puede modificarse a través de la variable de entorno VAGRANT_HOME. Por ejemplo, a través del siguiente comando:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nb">export</span><span class="w"> </span><span class="nv">VAGRANT_HOME</span><span class="o">=</span>/ruta/al/directorio
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo</p>
<p>Como puedes mover tus archivos <code>Vagrant</code> y máquinas virtuales <code>VirtualBox</code> de tu carpeta de inicio a un disco duro externo:</p>
</div>
<ol>
<li>Copia el directorio <code>.vagrant.d</code> de tu carpeta personal (<code>~/.vagrant.d</code>) al disco externo (Y renombra la carpeta a <code>vagrant_home</code>:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>cp<span class="w"> </span>-R<span class="w"> </span>~/.vagrant.d<span class="w"> </span>/Volumes/<span class="o">[</span>VOLUME_NAME<span class="o">]</span>/vagrant_home<span class="s2">&quot;</span>
</code></pre></div>
<ol start="2">
<li>Elimina el directorio <code>.vagrant.d</code> fde la carpeta personal:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>rm<span class="w"> </span>-rf<span class="w"> </span>~/vagrant.d
</code></pre></div>
<ol start="3">
<li>Edita tu archivo <code>.bash_profile</code>, y añade la siguiente línea:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nb">export</span><span class="w"> </span><span class="nv">VAGRANT_HOME</span><span class="o">=</span><span class="s2">&quot;/Volumes/[VOLUME_NAME]/vagrant_home&quot;</span>
</code></pre></div>
<ul>
<li>Para editarlo directamente:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export VAGRANT_HOME=&quot;/Volumes/[VOLUME_NAME]/vagrant_home&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bash_profile
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">advertencia</p>
<p>Para hacerlo permanente y no solo valga para una sesión, es necesario introducirlo en el <code>.bash_profile</code></p>
</div>
<ol start="4">
<li>Abre VirtualBox, vaya a Preferencias y establezca la carpeta de máquina predeterminada en una ubicación en su disco duro externo (por ejemplo una nueva carpeta llamada "VMs VirtualBox").</li>
</ol>
<h2 id="crear-una-mv-ya-configurada">Crear una MV ya configurada<a class="headerlink" href="#crear-una-mv-ya-configurada" title="Permanent link">&para;</a></h2>
<p>Hay <code>Boxes</code> subidas al Vagrant Cloud que no solo aportan un Sistema Operativo "limpio" sino que a parte tienen configurada alguna aplicación o servicio, para añadirlas correctamente su Vagrantfile viene especificado en el <code>git</code> que aparece en la descripción de la <code>box</code>.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo</p>
<p><a href="https://app.vagrantup.com/rasmus/boxes/php7dev">rasmus/php7dev</a></p>
</div>
<p>Para realizar un uso adecuado de está caja se clona el repositorio que contiene el Vagrantfile configurado con las características de esta imagen:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/rlerdorf/php7dev.git
</code></pre></div>
<p>Una vez clonado aparece la carpeta descargada donde podemos apreciar los archivos de <code>Vagrantfile</code> y de configuración <code>.yml</code>, como se observa a continuación.</p>
<figure>
  <img src="./imagenes/068/005G.gif"/>
  <figcaption>Vagrantfile y .yml de la Caja descargada.</figcaption>
</figure>

<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Una vez realizado el Vagrant up se puede acceder al servicio de <code>PHP</code></p>
</div>
<h2 id="principales-comandos-vagrant">Principales comandos Vagrant<a class="headerlink" href="#principales-comandos-vagrant" title="Permanent link">&para;</a></h2>
<p>En la <a href="https://developer.hashicorp.com/vagrant/docs/cli">DOCUMENTACIÓN OFICIAL</a> se encuentran todos los comandos de Vagrant, en los siguiente apartados se realiza un resumen de los más utilizados.</p>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>¡Asegúrate de estar en el mismo directorio que Vagrantfile cuando ejecutes estos comandos!</p>
</div>
<h3 id="crear-una-mv">Crear una MV<a class="headerlink" href="#crear-una-mv" title="Permanent link">&para;</a></h3>
<ul>
<li><code>vagrant init</code>           -- Inicializa Vagrant con un <code>Vagrantfile</code> y . /.vagrant directorio, sin imagen base especificada. Antes de poder hacer vagrant up, tendrás que especificar una imagen base en el <code>Vagrantfile</code>.</li>
<li><code>vagrant init &lt;boxpath&gt;</code> -- Inicializa Vagrant con una caja específica. Para encontrar una caja, accede al  <a href="https://app.vagrantup.com/boxes/search">public Vagrant box catalog</a>. Cuando encuentres uno que te guste, reemplaza su nombre con <code>boxpath</code>. Por ejemplo, <code>vagrant init ubuntu/trusty64</code>.</li>
</ul>
<h3 id="empezar-una-mv">Empezar una MV<a class="headerlink" href="#empezar-una-mv" title="Permanent link">&para;</a></h3>
<ul>
<li><code>vagrant up</code>                  -- comienza el entorno de vagrant (también disposiciones solo sobre el PRIMER vagrant up).</li>
<li><code>vagrant resume</code>              -- reanudar una máquina suspendida (vagrant up también se puede utilizar).</li>
<li><code>vagrant provision</code>           -- uerza el reaprovisionamiento de la máquina de vagrant.</li>
<li><code>vagrant reload</code>              -- reinicia la máquina vagrant, carga la nueva configuración de <code>Vagrantfile</code></li>
<li><code>vagrant reload --provision</code>  -- reinicie la máquina virtual y fuerce el aprovisionamiento</li>
</ul>
<h3 id="accediendo-a-una-maquina-vagrant">Accediendo a una máquina Vagrant<a class="headerlink" href="#accediendo-a-una-maquina-vagrant" title="Permanent link">&para;</a></h3>
<ul>
<li><code>vagrant ssh</code>           -- se conecta a la máquina a través de <code>SSH</code></li>
<li><code>vagrant ssh &lt;boxname&gt;</code> -- Si le das un nombre a tu box en tu Vagrantfile, puedes acceder via <code>ssh</code> sustituyendo el boxname por el nombre. Funciona desde cualquier directorio.</li>
</ul>
<h3 id="parando-una-mv">Parando una MV<a class="headerlink" href="#parando-una-mv" title="Permanent link">&para;</a></h3>
<ul>
<li><code>vagrant halt</code>        -- detiene la máquina de vagrant.</li>
<li><code>vagrant suspend</code>     -- suspende una máquina virtual (recuerda el estado).</li>
</ul>
<h3 id="limpiando-una-mv">limpiando una MV<a class="headerlink" href="#limpiando-una-mv" title="Permanent link">&para;</a></h3>
<ul>
<li><code>vagrant destroy</code>     -- detiene y elimina todos los rastros de la máquina de Vagrant.</li>
<li><code>vagrant destroy -f</code>   -- lo mismo que lo anterior, sin confirmación.</li>
</ul>
<h3 id="boxes">Boxes<a class="headerlink" href="#boxes" title="Permanent link">&para;</a></h3>
<ul>
<li><code>vagrant box list</code>              -- ver una lista de todas las cajas instaladas en tu ordenador.</li>
<li><code>vagrant box add &lt;name&gt; &lt;url&gt;</code>  -- descarga una imagen de caja en tu ordenador.</li>
<li><code>vagrant box outdated</code>          -- comprueba si hay actualizaciones en la vagrant box.</li>
<li><code>vagrant box remove &lt;name&gt;</code>   -- elimina una caja de la máquina</li>
<li><code>vagrant package</code>               -- empaqueta un virtualbox env en ejecución en una caja reutilizable</li>
</ul>
<h3 id="guarda-el-progreso">Guarda el Progreso<a class="headerlink" href="#guarda-el-progreso" title="Permanent link">&para;</a></h3>
<p>-<code>vagrant snapshot save [options] [vm-name] &lt;name&gt;</code> -- vm-name is often <code>default</code>. Permite guardar una instanténea</p>
<h3 id="tips">Tips<a class="headerlink" href="#tips" title="Permanent link">&para;</a></h3>
<ul>
<li><code>vagrant -v</code>                    -- consigue la versión vagrant</li>
<li><code>vagrant status</code>                -- estado de las salidas de vagrant machine</li>
<li><code>vagrant global-status</code>         -- stado de las salidas de todas las vagrant machines</li>
<li><code>vagrant global-status --prune</code> -- igual que el anterior, pero las entradas no son válidas</li>
<li><code>vagrant provision --debug</code>     -- usa la bandera de depuración para aumentar la verbosidad de la salida</li>
<li><code>vagrant push</code>                  -- ¡sí, vagrant se puede configurar para implementar código! <a href="http://docs.vagrantup.com/v2/push/index.html">deploy code</a>!</li>
<li><code>vagrant up --provision | tee provision.log</code>  -- Ejecuta <code>vagrant up</code>, fuerza el aprovisionamiento y registra toda la salida en un archivo</li>
</ul>
<h2 id="vagrantfile">Vagrantfile<a class="headerlink" href="#vagrantfile" title="Permanent link">&para;</a></h2>
<div class="admonition tip">
<p class="admonition-title">Consejo</p>
<p>Para visualizar por consola la lista de máquina virtuales en virtual box se puede utilizar el comando: <code>VBoxManage list vms</code></p>
</div>
<ul>
<li>La configuración de un escenario concreto se realiza de forma bastante simple mediante modificaciones en el <code>Vagrantfile</code>, que está escrito en formato Ruby, como ya se ha comentado.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Realmente la configuración que se aplica es la aplicación en serie de varios <code>Vagranfiles</code>, tal como se explica en en la documentación oficial en <a href="https://developer.hashicorp.com/vagrant/docs/vagrantfile#load-order-and-merging">Load Order and Merging</a>, aunque lo más habitual es que se cargue el <code>Vagrantfile</code> que incluye el box y el que exista en el directorio de trabajo, siendo este último el que se modifica en la mayoría de los casos.</p>
</div>
<h3 id="modificaciones-de-la-maquina-virtual">Modificaciones de la máquina virtual<a class="headerlink" href="#modificaciones-de-la-maquina-virtual" title="Permanent link">&para;</a></h3>
<ul>
<li>Las modificaciones se configuran en el espacio de nombres <code>config.vm</code>, prefijo que antecede a los parámetros en este caso, <code>por ejemplo</code> para modificar el hostname de la máquina se utiliza:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>config.vm.hostname<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;UbuntuServer22_Vagrant&quot;</span>
</code></pre></div>
<figure>
  <img src="./imagenes/068/002G.gif"/>
  <figcaption>Generar hostname a la MV de Vagrant.</figcaption>
</figure>

<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>El resto de parámetros que se pueden modificar los encontramos en la documentación de <a href="https://developer.hashicorp.com/vagrant/docs/vagrantfile/machine_settings">Vagrant: Machine Settings</a>, dejando en este caso para secciones posteriores algunos de los aspectos que necesitan más desarrollo como la configuración de la red o la configuración integrada de la máquina virtual mediante shell scripts o mediante aplicaciones como <code>Ansible</code> o <code>Puppet</code>.</p>
</div>
<ul>
<li>Los parámetros relativos a las <strong>características de hardware de la máquina virtual</strong> dependen del proveedor en Vagrant y en el caso de VirtualBox se definen mediante una sub-sección desde donde se realizan las modificaciones apropiadas en un Vagrantfile. <strong>Por ejemplo</strong> para cambiar el nombre de la máquina virtual, la memoria RAM asignada y el número de núcleos virtuales.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="w"> </span>config.vm.provider<span class="w"> </span><span class="s2">&quot;virtualbox&quot;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="p">|</span>vb<span class="p">|</span>
<span class="linenos" data-linenos="2 "></span><span class="w">     </span>vb.name<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;nombre&quot;</span>
<span class="linenos" data-linenos="3 "></span><span class="w">     </span>vb.memory<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;512&quot;</span>
<span class="linenos" data-linenos="4 "></span><span class="w">     </span>vb.cpus<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span>
<span class="linenos" data-linenos="5 "></span><span class="w">   </span>end
</code></pre></div>
<ul>
<li>Como la forma habitual de gestionar máquinas virtuales en <code>Vagrant</code> es mediante la línea de comandos y accediendo a ellas a través de ssh, no tiene mucho sentido que se arranque una interfaz gráfica, pero en algunas ocasiones es conveniente. Para activar la interfaz gráfica de usuario al levantar la máquina, se debe añadir la siguiente línea al <code>Vagrantfile</code>.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>config.vm.provider<span class="w"> </span><span class="s2">&quot;virtualbox&quot;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="p">|</span>vb<span class="p">|</span>
<span class="linenos" data-linenos="2 "></span><span class="w">     </span>vb.gui<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="w">     </span>
<span class="linenos" data-linenos="3 "></span><span class="w">   </span>end
</code></pre></div>
<h3 id="directorio-compartido">Directorio compartido<a class="headerlink" href="#directorio-compartido" title="Permanent link">&para;</a></h3>
<p>Por defecto cuando se ejecuta una MV con Vagrant se crea una carpeta compartida entre el Anfitrión y la MV. en este caso:</p>
<figure>
  <img src="./imagenes/068/006P.png"/>
  <figcaption>Directorio compartido por defecto en Vagrant.</figcaption>
</figure>

<figure>
  <img src="./imagenes/068/007P.png"/>
  <figcaption>En la MV de Vagrant se observa el Vagrantfile.</figcaption>
</figure>

<div class="admonition note">
<p class="admonition-title">Generar archivos</p>
<p>Si se genera un archivo en esta carpeta se generaría también en el anfitrión.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Existen casos en los cuales la carpeta compartida no se sincroniza correctamente, para solucionarlo existen las siguientes alternativas:</p>
</div>
<ul>
<li>Mediante <code>rsync</code>, la cual es una aplicación libre para sistemas de tipo Unix y Microsoft Windows que ofrece transmisión eficiente de datos incrementales. Para realizar la configuración Con Vagrant haríamos:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>config.vm.synced_folder<span class="w"> </span><span class="s2">&quot;.&quot;</span>,<span class="w"> </span><span class="s2">&quot;/vagrant&quot;</span>,<span class="w"> </span>type:<span class="w"> </span><span class="s2">&quot;rsync&quot;</span>
</code></pre></div>
<ul>
<li>Y lanzar en el <code>host</code> el comando:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>vagrant<span class="w"> </span>rsync-auto
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>La sincronización se lleva a cabo desde host a guest</p>
</div>
<ul>
<li>Otras alternativas son <code>NFS</code> o <code>SMB</code> de forma bidireccional:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>config.vm.synced_folder<span class="w"> </span><span class="s2">&quot;.&quot;</span>,<span class="w"> </span><span class="s2">&quot;/vagrant&quot;</span>,<span class="w"> </span>type:<span class="w"> </span><span class="s2">&quot;nfs&quot;</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Se requiere un servidor NFS (o SMB) en el host =&gt; se requiere red privada</p>
</div>
<h3 id="aprovisionamiento-ligero-thin-provisioning">Aprovisionamiento ligero (thin provisioning)<a class="headerlink" href="#aprovisionamiento-ligero-thin-provisioning" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Para los casos de necesidad de clonar muchas máquinas se aconseja utilizar el <strong>Aprovisionamiento ligero (thin provisioning)</strong>, el cual es una técnica muy utilizada en diferentes sistemas de virtualización.</p>
</li>
<li>
<p>Dicha técnica consiste en crear un disco de imagen de máquina virtual que incluya sólo las modificaciones respecto a una imagen base, consiguiendo un ahorro significativo de espacio en disco a costa de una pequeña penalización en rendimiento. </p>
</li>
<li>
<p>A continuación se muestra la configuración de un Vagrantfile para que realiza el <code>aprovisionamiento ligero</code>.</p>
</li>
</ul>
<ol>
<li>Revisamos cuanto ocupa la MV de ejemplo de hashicorp.</li>
</ol>
<figure>
  <img src="./imagenes/068/008P.png"/>
</figure>

<ol start="2">
<li>Para hacer la creación de la máquina ligera clonada se realiza en una carpeta a parte un nuevo proyecto y añadimos las siguientes líneas al <code>Vagrantfile</code>.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>config.vm.provider<span class="w"> </span><span class="s2">&quot;virtualbox&quot;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="p">|</span>vb<span class="p">|</span>
<span class="linenos" data-linenos="2 "></span><span class="w">     </span>vb.name<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ligera&quot;</span>
<span class="linenos" data-linenos="3 "></span><span class="w">     </span>vb.linked_clone<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
<span class="linenos" data-linenos="4 "></span><span class="w">   </span>end
</code></pre></div>
<figure>
  <img src="./imagenes/068/004G.gif"/>
  <figcaption>Configuración de aprovisionamiento ligero.</figcaption>
</figure>

<h3 id="redireccion-de-puertos">Redirección de puertos<a class="headerlink" href="#redireccion-de-puertos" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Si se necesita habilitar puertos para determinados servicios a instalar en la MV, se puede realizar una redirección de puertos. </p>
</li>
<li>
<p>Por ejemplo si además de utilizar la redirección de puertos de <code>ssh</code> que utiliza Vagrant se debería añadir la siguiente línea:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>config.vm.network<span class="w"> </span><span class="s2">&quot;forwarded_port&quot;</span>,<span class="w"> </span>guest:<span class="w"> </span><span class="m">80</span>,<span class="w"> </span>host:<span class="w"> </span><span class="m">8080</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Comprobación</p>
<p>Para comprobarlo se instalaría un NGINX en la máquina y accederíamos al servicio por el puerto configurado.</p>
</div>
<h3 id="anadir-disco-adicional">Añadir disco adicional<a class="headerlink" href="#anadir-disco-adicional" title="Permanent link">&para;</a></h3>
<p>Una de las configuraciones más utilizadas en los escenarios de entornos virtualizados es la adición de discos adicionales para obtener diferentes tipos de configuraciones como puede ser la redundancia de datos mediante técnicas de <code>RAID</code>.</p>
<p>En este caso Vagrant no dispone de comandos ni configuraciones para realizarlo, por lo que se debe añadir la programación necesaria en el <code>VagrantFile</code> que actue directamente al Virtualbox.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo</p>
<p>Creación de una máquina virtual que tenga un disco adicional de 500 GiB. Para ello se puede utilizar el siguiente código:</p>
</div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>config.vm.provider<span class="w"> </span><span class="s2">&quot;virtualbox&quot;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="p">|</span>vb<span class="p">|</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">     </span><span class="nv">file_to_disk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;tmp/disk.vdi&#39;</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">     </span>unless<span class="w"> </span>File.exist?<span class="o">(</span>file_to_disk<span class="o">)</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">       </span>vb.customize<span class="w"> </span><span class="o">[</span><span class="s1">&#39;createhd&#39;</span>,<span class="w"> </span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">                     </span><span class="s1">&#39;--filename&#39;</span>,<span class="w"> </span>file_to_disk,<span class="w"> </span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">                     </span><span class="s1">&#39;--size&#39;</span>,<span class="w"> </span><span class="m">500</span><span class="w"> </span>*<span class="w"> </span><span class="m">1024</span><span class="o">]</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">     </span>end
<span class="linenos" data-linenos=" 8 "></span><span class="w">     </span>vb.customize<span class="w"> </span><span class="o">[</span><span class="s1">&#39;storageattach&#39;</span>,<span class="w"> </span>:id,<span class="w"> </span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">                   </span><span class="s1">&#39;--storagectl&#39;</span>,<span class="w"> </span><span class="s1">&#39;SATAController&#39;</span>,<span class="w"> </span>
<span class="linenos" data-linenos="10 "></span><span class="w">                   </span><span class="s1">&#39;--port&#39;</span>,<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>
<span class="linenos" data-linenos="11 "></span><span class="w">                   </span><span class="s1">&#39;--device&#39;</span>,<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>
<span class="linenos" data-linenos="12 "></span><span class="w">                   </span><span class="s1">&#39;--type&#39;</span>,<span class="w"> </span><span class="s1">&#39;hdd&#39;</span>,<span class="w"> </span>
<span class="linenos" data-linenos="13 "></span><span class="w">                   </span><span class="s1">&#39;--medium&#39;</span>,<span class="w"> </span>file_to_disk<span class="o">]</span>
<span class="linenos" data-linenos="14 "></span><span class="w">   </span>end
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<ul>
<li>Este tipo de configuraciones en las que se pone de forma explícita las características de la máquina virtual no son ni mucho menos generales, en el caso anterior se está poniendo de forma concreta el puerto <code>SATA</code> al que conectar el disco y el nombre del controlador <code>SATA</code>, características que pueden variar de una máquina virtual a otra. </li>
<li>Por lo tanto Es recomendable inicialmente comprobar el nombre del controlador de <code>SATA</code> que en el caso de VirtualBox se puede hacer con el siguiente comando de VBoxManage</li>
</ul>
</div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>VBoxManage<span class="w"> </span>showvminfo<span class="w"> </span>NOMBRE_MV
</code></pre></div>
<figure>
  <img src="./imagenes/068/005G.gif"/>
  <figcaption>Comprobación del nombre del controlador de SATA y creación del disco adicional.</figcaption>
</figure>

<ul>
<li>Después de levantar el Vagrant o realizar un <code>reload</code>, se comprueba la configuración:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>lsblk
<span class="linenos" data-linenos="2 "></span>ls<span class="w"> </span>-hl<span class="w"> </span>tmp/
</code></pre></div>
<figure>
  <img src="./imagenes/068/006G.gif"/>
  <figcaption>Comprobación de la creación del disco adicional.</figcaption>
</figure>

<h2 id="gestion-de-instantaneas">Gestión de instantáneas<a class="headerlink" href="#gestion-de-instantaneas" title="Permanent link">&para;</a></h2>
<ul>
<li>Para generar y recuperar instantáneas en <code>Vagrant</code> se utiliza el comando <code>vagrant snapshot</code> seguido de la acción a realizar o bien guardar o recuperar.</li>
</ul>
<div class="admonition example">
<p class="admonition-title">Ejemplo</p>
<p>Partiendo de un escenario de vagrant con una MV que tenga instalada un NGINX y un reenvío de puertos. Se genera una <code>snapshot</code> para realizar algún cambio y restaurar la captura guardada.</p>
</div>
<ul>
<li>Comandos:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># se genera la captura.</span>
<span class="linenos" data-linenos="2 "></span>vagrant<span class="w"> </span>snapshot<span class="w"> </span>save<span class="w"> </span>nginx-limpio
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="c1"># se comprueba que se ha creado.</span>
<span class="linenos" data-linenos="5 "></span>vagrant<span class="w"> </span>snapshot<span class="w"> </span>list
<span class="linenos" data-linenos="6 "></span>
<span class="linenos" data-linenos="7 "></span><span class="c1"># Después de realizar algún cambio se restaura.</span>
<span class="linenos" data-linenos="8 "></span>vagrant<span class="w"> </span>snapshot<span class="w"> </span>restore<span class="w"> </span>nginx-limpio
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Consejo</p>
<p>Existe un método más sencillo de realizar instantáneas, es mediante el comando <code>vagrant snapshot push</code> que va almacenando instantáneas cada vez que se invoca y se recupera la más reciente con <code>vagrant snapshot pop</code>.</p>
</div>
<h2 id="redes">Redes<a class="headerlink" href="#redes" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Por defecto Vagrant realiza los pasos necesarios en la máquina virtual para que sea accesible a través de una red virtual desde el equipo anfitrión y tenga acceso a Internet, es decir le configura una red.</p>
</li>
<li>
<p>Esta configuración lógicamente va a variar en función del proveedor, pero en el caso de VirtualBox se trata de una red de tipo NAT con el direccionamiento inicial 10.0.2.0/24. Las opciones de redes son:</p>
</li>
</ul>
<h3 id="red-privada">Red privada<a class="headerlink" href="#red-privada" title="Permanent link">&para;</a></h3>
<p>En algunas ocasiones aparece la necesidad de utilizar un direccionamiento IP específico en una máquina virtual o añadir una red virtual adicional, por lo que en muchos casos es adecuado añadir una red privada, tal como se explica en <a href="https://developer.hashicorp.com/vagrant/docs/networking/private_network">Private Networks</a>.</p>
<div class="admonition example">
<p class="admonition-title">Ejemplo</p>
</div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>config.vm.network<span class="w"> </span><span class="s2">&quot;private_network&quot;</span>,<span class="w"> </span>ip:<span class="w"> </span><span class="s2">&quot;192.168.55.10&quot;</span>
</code></pre></div>
<h3 id="red-publica">Red pública<a class="headerlink" href="#red-publica" title="Permanent link">&para;</a></h3>
<p>Para vagrant una red pública es una red en modo puente (<strong>bridged network</strong>) conectada al exterior, típicamente sería poner en la misma red la máquina anfitriona y la máquina virtual. Más detalles en <a href="https://developer.hashicorp.com/vagrant/docs/networking/public_network">Public Networks</a></p>
<div class="admonition example">
<p class="admonition-title">Ejemplo</p>
</div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>config.vm.network<span class="w">  </span><span class="s2">&quot;public_network&quot;</span>,<span class="w"> </span>bridge:<span class="w"> </span><span class="s2">&quot;eth0&quot;</span>
</code></pre></div>
<h2 id="multi-maquinas">Multi-máquinas<a class="headerlink" href="#multi-maquinas" title="Permanent link">&para;</a></h2>
<ul>
<li>Se puede extender la configuración de un escenario virtual con vagrant a aquellos casos en los que haya más de una máquina virtual y esto se hace con estructuras como la siguiente en el Vagrantfile:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>Vagrant.configure<span class="o">(</span><span class="s2">&quot;2&quot;</span><span class="o">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="p">|</span>config<span class="p">|</span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span>config.vm.define<span class="w"> </span><span class="s2">&quot;Server&quot;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="p">|</span>m1<span class="p">|</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span>m1.vm.box<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Ecodev/ubuntu-server-2204&quot;</span>
<span class="linenos" data-linenos="4 "></span><span class="w">  </span>end
<span class="linenos" data-linenos="5 "></span><span class="w">  </span>config.vm.define<span class="w"> </span><span class="s2">&quot;Client&quot;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="p">|</span>m2<span class="p">|</span>
<span class="linenos" data-linenos="6 "></span><span class="w">    </span>m2.vm.box<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hashicorp/bionic64&quot;</span>
<span class="linenos" data-linenos="7 "></span><span class="w">  </span>end
<span class="linenos" data-linenos="8 "></span>end
</code></pre></div>
<ul>
<li>Al existir más de una máquina virtual, muchas de las instrucciones que hemos visto hasta ahora deben incluir el nombre de la máquina como parámetro, por ejemplo si hiciéramos:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>vagrant<span class="w"> </span>ssh<span class="w"> </span>Server
</code></pre></div>
<div class="admonition example">
<p class="admonition-title">Ejemplo</p>
<p>Crea un escenario para una aplicación web en la que ubicamos en una máquina el servidor <strong>Ubuntu 22</strong> conectado a una red pública exterior y una máquina con un <strong>cliente</strong> en una máquina no accesible desde el exterior. Para que ambas máquinas estén interconectadas entre sí, crea la red privada <code>10.0.100.0/24</code> a la que estarán conectadas ambas máquinas.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>Vagrant.configure<span class="o">(</span><span class="s2">&quot;2&quot;</span><span class="o">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="p">|</span>config<span class="p">|</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">     </span>config.vm.define<span class="w"> </span><span class="s2">&quot;ServerMulti1&quot;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="p">|</span>nodo1<span class="p">|</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">       </span>nodo1.vm.box<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Ecodev/ubuntu-server-2204&quot;</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">       </span>nodo1.vm.hostname<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;UbuntuServerMulti&quot;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">       </span>nodo1.vm.network<span class="w"> </span><span class="s2">&quot;public_network&quot;</span>,<span class="w"> </span>bridge:<span class="w"> </span><span class="s2">&quot;en0&quot;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">       </span>nodo1.vm.network<span class="w"> </span><span class="s2">&quot;private_network&quot;</span>,<span class="w"> </span>ip:<span class="w"> </span><span class="s2">&quot;10.0.100.101&quot;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">     </span>end
<span class="linenos" data-linenos=" 8 "></span><span class="w">     </span>config.vm.define<span class="w"> </span><span class="s2">&quot;ClientMulti1&quot;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="p">|</span>nodo2<span class="p">|</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">       </span>nodo2.vm.box<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;hashicorp/bionic64&quot;</span>
<span class="linenos" data-linenos="10 "></span><span class="w">       </span>nodo2.vm.hostname<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ClienteMulti&quot;</span>
<span class="linenos" data-linenos="11 "></span><span class="w">       </span>nodo2.vm.network<span class="w"> </span><span class="s2">&quot;private_network&quot;</span>,<span class="w"> </span>ip:<span class="w"> </span><span class="s2">&quot;10.0.100.102&quot;</span>
<span class="linenos" data-linenos="12 "></span><span class="w">     </span>end
<span class="linenos" data-linenos="13 "></span><span class="w">   </span>end
</code></pre></div>
<h2 id="actividades-de-clase-ap">Actividades de clase (AP)<a class="headerlink" href="#actividades-de-clase-ap" title="Permanent link">&para;</a></h2>
<h3 id="ac64-introduccion-a-entornos-de-desarrollo-mediante-vagrant">AC64. Introducción a entornos de desarrollo mediante Vagrant<a class="headerlink" href="#ac64-introduccion-a-entornos-de-desarrollo-mediante-vagrant" title="Permanent link">&para;</a></h3>
<p>Realiza los siguientes tareas introductorias a <strong>Vagrant</strong>.</p>
<ol>
<li>Monta el escenario necesario para trabajar con <code>Vagrant</code>.</li>
</ol>
<ul>
<li>Instala <code>Vagrant</code>.</li>
<li>Realiza un primer proyecto.</li>
<li>Externaliza la carpeta de boxes a un disco externo (si es posible).</li>
<li>Crea y destruye varias MVs.</li>
</ul>
<ol start="2">
<li>
<p>Genera un Vagrantfile multimáquina con un servidor web y un cliente que pueda acceder al servidor de forma privada. El servidor debe tener salida a Internet. Comprueba que tiene acceso al <code>index.html</code> del servidor web y modifícalo.</p>
</li>
<li>
<p>Crea un entorno de desarrollo portable con Vagrant con algunas de las boxes más utilizadas del catálogo (por ejemplo ubuntu/xenial64 o centos7):</p>
</li>
</ol>
<ul>
<li>Prueba los distintos tipos de <code>synced folders</code>. Comprueba si, para tu plataforma, en cada uno de ellos funciona adecuadamente los enlaces simbólicos y la sincronización en uno y otro sentido:</li>
<li>Shared folder de virtualbox ▹ Rsync</li>
<li>NFS</li>
<li>Prueba a compartir por los métodos anteriores carpetas de tu equipo en otras ubicaciones de la máquina guest.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">NOTA</p>
<p>usa vagrant reload cada vez que cambies la configuración.</p>
</div>
<ol start="4">
<li>Crea una máquina con un NGINX y un reenvío de puertos, Genera una <code>Snapshot</code> haz algún cambio en el <code>index.html</code>. Regenera la captura y comprueba que el index.html está como de inicio.</li>
</ol>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2023-2024 Francisco Javier Hernández Illán - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="mailto:<fj.hernandez@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48H48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0L0 176z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/fjavier-hernandez-illan" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  




  


<h4>Consentimiento de cookie</h4>
<p>Esta página de apuntes utiliza cookies para reconocer las visitas, medir la efectividad de la documentación y averiguar si encuentras aquello que buscas o cómo has llegado a estos apuntes. Con tu consentimiento, me ayudas a mejorar estos materiales.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Aceptar</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Gestionar cookies</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["header.autohide", "toc.integrate", "navigation.indexes", "navigation.top", "navigation.tracking", "toc.follow"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>