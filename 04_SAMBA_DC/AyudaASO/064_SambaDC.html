
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/fjavier-hernandez/sor/04_SAMBA_DC/AyudaASO/064_SambaDC.html">
      
      
      
      
      <link rel="icon" href="../../imagenes/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>SAMBA DOMAIN CONTROLLER - Sistemas Operativos en Red</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-0CPJP88MBF"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-0CPJP88MBF",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-0CPJP88MBF",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="javi" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#samba-domain-controller" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../../index.html" title="Sistemas Operativos en Red" class="md-header__button md-logo" aria-label="Sistemas Operativos en Red" data-md-component="logo">
      
  <img src="../../imagenes/SOR_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Sistemas Operativos en Red
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              SAMBA DOMAIN CONTROLLER
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="javi" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Sistemas Operativos en Red" class="md-nav__button md-logo" aria-label="Sistemas Operativos en Red" data-md-component="logo">
      
  <img src="../../imagenes/SOR_logo.png" alt="logo">

    </a>
    Sistemas Operativos en Red
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../SituacionAprendizaje.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Situación de Aprendizaje
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../Evaluacion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evaluación
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    1.- Instalación de Sistemas Operativos en red.
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            1.- Instalación de Sistemas Operativos en red.
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_INTRO_SOR/001_IntroSOR.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.1- Introducción a Sistemas Operativos en Red
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_INTRO_SOR/002_Virtualizaci%C3%B3n.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.2- Virtualización
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01_INTRO_SOR/006_Instalacion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.3- Instalación de Sistemas Operativos en Red
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="samba-domain-controller">SAMBA DOMAIN CONTROLLER<a class="headerlink" href="#samba-domain-controller" title="Permanent link">&para;</a></h1>
<figure>
  <img src="./imagenes/067/001P.png" width="850"/>
</figure>

<h2 id="actividades-tipo-proyecto-aea">Actividades tipo Proyecto (AEA)<a class="headerlink" href="#actividades-tipo-proyecto-aea" title="Permanent link">&para;</a></h2>
<h3 id="pr61-introduccion-y-configuracion-de-samba-dc">PR61. Introducción y configuración de Samba DC<a class="headerlink" href="#pr61-introduccion-y-configuracion-de-samba-dc" title="Permanent link">&para;</a></h3>
<p>Tal y como se plantea en la situación de aprendizaje trabajas para el departamento TIC de <strong>ASOps</strong>, y acaban de aparecer los siguientes proyectos para la integración de Samba DC.</p>
<p>Instalación y configuración de Samba DC en los siguientes servidores Linux:</p>
<ul>
<li>Red Hat.</li>
<li>Centos.</li>
<li>Debian.</li>
<li>Fedora.</li>
<li>OpenSuse</li>
</ul>
<p>Debes de elegir la distribución a implementar <strong>Samba DC</strong> y desarrollar con tu grupo para poder loguear clientes Windows y compartir recursos entre ellos. Tareas a realizar:</p>
<ul>
<li>Desarrollad un informe con las capturas explicadas de los principales pasos de esta guía y sus comprobaciones.</li>
<li>Añadid un usuario mediante Webmin. Reinicia W10 y logueate con este nuevo usuario.</li>
<li>Eligid de entre estas dos distribuciones de Linux Red Hat, Manjaro o Fedora para añadir el cliente al AD y loguearte con alguno de los usuarios configurados.</li>
<li>Genera una estructura de carpetas de empresa (a desarrollar) de los diferentes departamentos y aplica niveles de seguridad de acceso a los mismos.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Añadid capturas con sus correspondientes aclaraciones en cada aparatado.</p>
</div>
<h2 id="guia-samba-dc-ubuntu-server">Guía Samba DC Ubuntu Server<a class="headerlink" href="#guia-samba-dc-ubuntu-server" title="Permanent link">&para;</a></h2>
<p>Los objetivos de esta guía son:</p>
<ul>
<li>Preparación del servidor.</li>
<li>Instalar el Controlador de Dominio en Samba.</li>
<li>Acceder y Crear clientes de windows.</li>
<li>Activar la aplicación de gestión RSAT.</li>
</ul>
<!-- - Configurar los recursos compartidos. -->

<p><a href="https://wiki.samba.org/index.php/Setting_up_Samba_as_an_Active_Directory_Domain_Controller#Provisioning_Samba_AD_in_Interactive_Mode">Webgrafía</a></p>
<h2 id="recordatorio-controlador-de-dominio-dc">Recordatorio Controlador de Dominio (DC).<a class="headerlink" href="#recordatorio-controlador-de-dominio-dc" title="Permanent link">&para;</a></h2>
<ul>
<li>Es un <strong>servidor</strong> que se ocupa de permitir el acceso de determinados usuarios a recursos compartidos del dominio.</li>
<li>Un <strong>dominio</strong> es un grupo de recursos (equipos, ficheros, usuarios, impresoras, etc.) dentro de una red. El acceso a dicho dominio o las políticas de seguridad de todos esos recursos es administrada por el controlador de dominio.</li>
<li>Habitualmente se implementan en Windows Server, aunque también se pueden implementar en Linux bajo samba.</li>
<li>En una implementación adecuada, se despliega más de un controlador de dominio a la vez que actúan como uno (cluster) de esta forma se dota al <strong>servicio de redundancia y alta disponibilidad</strong>, es decir, que si se produce una avería en un control de dominio el servicio sigue activo pues hay otro/s controladores activos.</li>
<li>Los dominios usan rutas de nombres similares a los DNS, tienen una ruta absoluta <strong>FQDN (Full
Qualified Domain Name)</strong> y una ruta relativa <strong>PQDN (Partially Qualified Domain Name)</strong>.</li>
</ul>
<div class="admonition note">
<p class="admonition-title"><strong>NOTA:</strong></p>
<p>Independientemente del sistema operativo usado necesitaremos de otros servicios para complementar, a continuación se enumeran:</p>
</div>
<ul>
<li><strong>LDAP</strong>: Será la base de datos que alberga la información de los usuarios.</li>
<li><strong>Kerberos</strong>: Se encarga de la seguridad a nivel de autentificación segura de los usuarios.</li>
<li><strong>DNS</strong>: Habitualmente el acceso al dominio se hace a través de un nombre de dominio. El
servicio DNS permite la resolución de ese nombre de dominio al direccionamiento IP.</li>
<li><strong>NTP</strong>: Es el servicio que se encarga de la sincronización del reloj de cada máquina.</li>
</ul>
<h2 id="preparacion">Preparación<a class="headerlink" href="#preparacion" title="Permanent link">&para;</a></h2>
<p>Antes de la instalación del <strong>Controlador de Dominio o Domain Controler DC</strong> mediante <code>Samba</code>, es necesaria, la preparación del servidor a nivel de red y dominio. Para ello se detallan los siguientes pasos:</p>
<ol>
<li>Restaura un <strong>snapshot</strong> "limpio" de tu máquina virtual de <code>Ubuntu 22.04</code> y se realiza un update.</li>
</ol>
<figure>
  <img src="./imagenes/067/000G.gif"/>
  <figcaption>Comprobación versión Ubuntu.</figcaption>
</figure>

<ol start="2">
<li>Configura la máquina virtual en formato “<strong>Nat Network</strong>”.</li>
</ol>
<!-- 3. Establecemos una configuración de red para tu servidor.
    1. Se establece una IP estática en el servidor del rango configurado en la red NAT, en este caso se realiza editando el fichero `nano /etc/netplan/00-installer-config.yaml` de la siguiente forma:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="c1"># This is the network config written by &#39;subiquity&#39;</span>
<span class="linenos" data-linenos=" 2 "></span>network:
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span>ethernets:
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span>enp0s3:
<span class="linenos" data-linenos=" 5 "></span><span class="w">      </span>dhcp4:<span class="w"> </span>no
<span class="linenos" data-linenos=" 6 "></span><span class="w">      </span>addresses:
<span class="linenos" data-linenos=" 7 "></span><span class="w">        </span>-<span class="w"> </span><span class="m">192</span>.168.2.2/24
<span class="linenos" data-linenos=" 8 "></span><span class="w">      </span>nameservers:
<span class="linenos" data-linenos=" 9 "></span><span class="w">        </span>search:<span class="w"> </span><span class="o">[</span>aso.com<span class="o">]</span>
<span class="linenos" data-linenos="10 "></span><span class="w">        </span>addresses:<span class="w"> </span><span class="o">[</span><span class="m">8</span>.8.8.8,<span class="w"> </span><span class="m">8</span>.8.4.4<span class="o">]</span>
<span class="linenos" data-linenos="11 "></span><span class="w">      </span>routes:
<span class="linenos" data-linenos="12 "></span><span class="w">        </span>-<span class="w"> </span>to:<span class="w"> </span>default
<span class="linenos" data-linenos="13 "></span><span class="w">          </span>via:<span class="w"> </span><span class="m">192</span>.168.2.1
<span class="linenos" data-linenos="14 "></span><span class="w">  </span>version:<span class="w"> </span><span class="m">2</span>
</code></pre></div>

<figure>
  <img src="./imagenes/067/002P.png"/>
  <figcaption>Configuración de IP estática en Red NAT.</figcaption>
</figure>

!!! tip "A tener en cuenta"
    - En la configuración del archivo de red se crea un parámetro denominado `search`, el cual se configura para realizar un **dominio de búsqueda** (**Search Domain**), el cual nos va a permitir que si el servidor recibe una búsqueda de petición de un recurso, por ejemplo “maquina03”, automáticamente el servidor va intentar buscar por el nombre de dominio completo: “maquina01.aso.com”. Es decir, intenta resolver una ruta relativa de dominio (`PQDN`) a una ruta absoluta de dominio (`FQDN`).
    -Recordatorio: se debe de aplicar los cambios con **netplan apply**. -->

<!-- <figure>
  <img src="./imagenes/07/072/007.png" width="550"/>
</figure> -->

<!-- 3. Instala los paquetes “`dnsutils`”.
    1. El paquete `dnsutils` simplemente es una serie de herramientas que ayudan a comprobar la resolución del nombre de nuestro dominio es correcta.

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span>-y
<span class="linenos" data-linenos="2 "></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>dnsutils
</code></pre></div>

<figure>
  <img src="./imagenes/067/001G.gif"/>
  <figcaption>Instalación dnsutils.</figcaption>
</figure> -->

<!-- 5. Es conveniente saber cuál es el nombre de nuestra máquina:

<figure>
  <img src="./imagenes/07/072/008.png" width="550"/>
</figure> -->

<ol start="3">
<li>A continuación se establece el nombre de host del servidor este caso <code>profesor.aso.local</code> y se añade el servidor al archivo de hosts.</li>
</ol>
<div class="admonition warning">
<p class="admonition-title"><strong>CUIDADO</strong></p>
<p><strong>Se debe cambiar profesor por el nombre de la alumna o alumno.</strong></p>
</div>
<p>3.1. Cambio de nombre de hosts a profesor.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>hostnamectl<span class="w"> </span>set-hostname<span class="w"> </span>profesor
</code></pre></div>
<p>3.2. El fichero <code>/etc/hosts</code> es como un servicio DNS local, es decir, tiene una serie de pares <code>nombres/IP</code> que resuelve localmente.
  1. Realiza una copia de seguridad del fichero <code>/etc/hosts</code>.
  2. Modifica el fichero original (<code>/etc/hosts</code>) para que resuelva el nombre de tu máquina y tu FQDN en este caso <code>profesor.aso.local</code>.
  3. Comprueba con un ping a los nombres que funciona y te contesta con la IP.</p>
<div class="admonition example">
<p class="admonition-title">Por ejemplo</p>
<p>Inicialmente En este caso el servidor se llama aso, por lo tanto si se realiza un ping a <code>aso</code> antes de modificar el /etc/hosts la máquina debe saber resolverlo a la IP <code>127.0.1.1</code> que por defecto en ubuntu se utiliza para determinar la dirección IP que corresponde al nombre de host.</p>
</div>
<ul>
<li>En este caso el fichero modificado quedaría:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="m">127</span>.0.0.1<span class="w"> </span>localhost
<span class="linenos" data-linenos="2 "></span><span class="m">192</span>.168.2.4<span class="w"> </span>profesor.aso.local<span class="w"> </span>profesor
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="c1"># The following lines are desirable for IPv6 capable hosts</span>
<span class="linenos" data-linenos="5 "></span>::1<span class="w">     </span>ip6-localhost<span class="w"> </span>ip6-loopback
<span class="linenos" data-linenos="6 "></span>fe00::0<span class="w"> </span>ip6-localnet
<span class="linenos" data-linenos="7 "></span>ff00::0<span class="w"> </span>ip6-mcastprefix
<span class="linenos" data-linenos="8 "></span>ff02::1<span class="w"> </span>ip6-allnodes
<span class="linenos" data-linenos="9 "></span>ff02::2<span class="w"> </span>ip6-allrouters
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Cuidado</p>
<p>La nueva IP es la recibida en el servidor del <code>DHCP</code> de la RedNAT configurada.</p>
</div>
<p>3.3. Ejecución y comprobación.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># verifica FQDN</span>
<span class="linenos" data-linenos="2 "></span>hostname<span class="w"> </span>-f
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="c1"># verifica FQDN si resuelve a la IP del servidor</span>
<span class="linenos" data-linenos="5 "></span>ping<span class="w"> </span>-c3<span class="w"> </span>profesor.aso.local
</code></pre></div>
<figure>
  <img src="./imagenes/067/002G.gif"/>
  <figcaption>Modificación del <b>/etc/hosts</b> y comprobaciones de ping.</figcaption>
</figure>

<ol start="4">
<li>Se configura la resolución de nombres en el archivo <code>resolv.conf</code> encargado de redireccionar las peticiones de <code>DNS</code>.</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">A tener en cuenta</p>
<ul>
<li>Para realizar un <strong>dominio de búsqueda</strong> (<strong>Search Domain</strong>), el cual nos va a permitir que si el servidor recibe una búsqueda de petición de un recurso, por ejemplo “maquina01”, automáticamente el servidor va intentar buscar por el nombre de dominio completo: “maquina01.aso.com”. Es decir, intenta resolver una ruta relativa de dominio (<code>PQDN</code>) a una ruta absoluta de dominio (<code>FQDN</code>).</li>
<li><strong>Recordatorio</strong>: se debe de aplicar los cambios con <strong>netplan apply</strong>.</li>
</ul>
</div>
<p>a. Se desactiva el servicio de resolución de DNS.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># Para y desactiva el servicio de resolución de DNS</span>
<span class="linenos" data-linenos="2 "></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>disable<span class="w"> </span>--now<span class="w"> </span>systemd-resolved
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="c1"># Elimina el link simbólico de /etc/resolv.conf</span>
<span class="linenos" data-linenos="5 "></span>sudo<span class="w"> </span>unlink<span class="w"> </span>/etc/resolv.conf
</code></pre></div>
<p>b. Se crea un nuevo <code>resolv</code></p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># Crea un nuevo archivo /etc/resolv.conf</span>
<span class="linenos" data-linenos="2 "></span>nano<span class="w"> </span>/etc/resolv.conf
</code></pre></div>
<p>c. Se introduce las siguientes líneas en el archivo nuevo.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># Samba server IP address</span>
<span class="linenos" data-linenos="2 "></span>nameserver<span class="w"> </span><span class="m">192</span>.168.2.4
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="c1"># fallback resolver Quad9</span>
<span class="linenos" data-linenos="5 "></span>nameserver<span class="w"> </span><span class="m">9</span>.9.9.9
<span class="linenos" data-linenos="6 "></span>
<span class="linenos" data-linenos="7 "></span><span class="c1"># Dominio principal de Samba</span>
<span class="linenos" data-linenos="8 "></span>search<span class="w"> </span>aso.local
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Cuidado</p>
<p>La IP es la recibida en el servidor del <code>DHCP</code> de la RedNAT configurada</p>
</div>
<p>d. Se hace inmutable el archivo para evitar que cualquier instalación de otros servicios lo modifique automáticamente.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># add attribute immutable to the file /etc/resolv.conf</span>
<span class="linenos" data-linenos="2 "></span>sudo<span class="w"> </span>chattr<span class="w"> </span>+i<span class="w"> </span>/etc/resolv.conf
</code></pre></div>
<figure>
  <img src="./imagenes/067/008G.gif"/>
  <figcaption>Configuración de resolución de nombres.</figcaption>
</figure>

<!-- <figure>
  <img src="./imagenes/07/072/009.png" width="850"/>
  <figcaption>Ping a profesor.</figcaption>
</figure>

<figure>
  <img src="./imagenes/07/072/010.png" width="850"/>
  <figcaption>Comprobación `/etc/hosts`.</figcaption>
</figure>

<figure>
  <img src="./imagenes/07/072/011.png" width="850"/>
  <figcaption>Comprobación de ping al localhost debería contestar 127.0.0.1.</figcaption>
</figure>

<figure>
  <img src="./imagenes/07/072/012.png" width="850"/>
  <figcaption>Comprobaciónes de ping.</figcaption>
</figure> -->

<!-- 7. A continuación instalamos los paquetes “**attr**” y “**acl**” que nos darán más opciones de seguridad y mayor compatibilidad al interconectar con equipos clientes Windows a nuestro dominio.

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>attr<span class="w"> </span>acl
</code></pre></div>

<figure>
  <img src="./imagenes/067/003G.gif"/>
  <figcaption>Instalación de los paquetes <b>attr</b> y <b>acl</b>.</figcaption>
</figure>

8. En el siguiente paso se aplican estos paquetes al **sistema cuando se arranque**. Para ello, Se realiza una copia de seguridad del fichero `/etc/fstab` y posteriormente lo editamos. **Importante** que el separador en este fichero es el tabulador.
    1. Simplemente hay que añadir en el raíz (“/”) las opciones **user_xattr,acl,barrier=1,defaults** donde antes sólo ponía `defaults 0 1`.

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>user_xattr,acl,barrier<span class="o">=</span><span class="m">1</span>,defaults
</code></pre></div>

!!! warning advertencia
    - Importante no equivocarse y hacerlo en el “/”, no en el `/boot` ni en la memoria **swap**.
    - Reiniciar el server (reboot).

<figure>
  <img src="./imagenes/067/004G.gif"/>
  <figcaption>Aplicar <b>attr</b> y <b>acl</b> al sector de arranque.</figcaption>
</figure>

<!-- - **Ejemplos:** -->

<!-- <figure>
  <img src="./imagenes/07/072/013.png" width="750"/>
  <figcaption>attr y acl acl al sector de arranque en /etc/fstab.</figcaption>
</figure> -->

<!-- 9. Se instala el paquete **NTP**, ya que es necesario tener sincronizada la hora para servicios del estilo **firewall**, **LDAP**, para los registros de los logs, para el servicio activo de Windows, etc.
    1. Se puede comprobar que el servicio está activo con `“systemctl status ntp”`

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>ntp
</code></pre></div>

<figure>
  <img src="./imagenes/067/005G.gif"/>
  <figcaption>Instalación y comprobación <b>NTP</b>.</figcaption>
</figure> -->

<h2 id="instalacion-samba-dc">Instalación Samba-DC<a class="headerlink" href="#instalacion-samba-dc" title="Permanent link">&para;</a></h2>
<!-- 10. **Detenemos y deshabilitamos** cualquier servicio que tuviéramos de samba (que no fuera de
    controlador de dominio) previa a la instalación.

<figure>
  <img src="./imagenes/07/072/014.png" width="750"/>
</figure>

11. Eliminamos cualquier configuración previa de samba o de kerberos.

apt-get install -y acl attr samba samba-dsdb-modules samba-vfs-modules smbclient winbind libpam-winbind libnss-winbind libpam-krb5 krb5-config krb5-user dnsutils chrony net-tools -->

<ol>
<li>Se instalan los siguientes paquetes:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span>-y
<span class="linenos" data-linenos="2 "></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>acl<span class="w"> </span>attr<span class="w"> </span>samba<span class="w"> </span>samba-dsdb-modules<span class="w"> </span>samba-vfs-modules<span class="w"> </span>smbclient<span class="w"> </span>winbind<span class="w"> </span>libpam-winbind<span class="w"> </span>libnss-winbind<span class="w"> </span>libpam-krb5<span class="w"> </span>krb5-config<span class="w"> </span>krb5-user<span class="w"> </span>chrony<span class="w"> </span>net-tools
</code></pre></div>
<div class="admonition abstract">
<p class="admonition-title">Donde se destacan los siguientes:</p>
<ol>
<li><strong>Samba</strong> &#8594; En el paquete ya viene integrado un módulo de <code>LDAP</code> para almacenar los usuarios.</li>
<li><strong>krb5-config</strong> &#8594; Es la configuración de <code>Kerberos</code> que usaremos en samba. Habrá que instalarlo más adelante.</li>
<li><strong>winbind</strong> &#8594; Paquete necesario para que un cliente de <code>Windows</code> se pueda autentificar en nuestro sistema DC en Linux.</li>
<li><strong>smbclient</strong> &#8594; Se instala el cliente samba, simplemente para tener ciertos comandos de consulta, realmente no es necesario para montar el servidor.</li>
</ol>
</div>
<div class="admonition tip">
<p class="admonition-title">Durante la instalación del <strong>Kerberos</strong> nos pedirá 3 cosas principalmente:</p>
<ol>
<li><strong>El reino (realm)</strong>: se indicará el mismo que el dominio configurado en el archivo de configuración de red.</li>
<li><strong>La IP del servidor Kerberos</strong>: FQDN.</li>
<li><strong>La IP para la administración del Kerberos</strong>: FQDN.</li>
</ol>
</div>
<div class="admonition note">
<p class="admonition-title"><strong>Nota</strong></p>
<p>En este caso el servidor de kerberos va a estar en el propio controlador de dominio, pero en otra situación se podría tratar de una máquina independiente.</p>
</div>
<figure>
  <img src="./imagenes/067/006G.gif"/>
  <figcaption>Instalación samba y paquetes necesarios.</figcaption>
</figure>

<!-- <figure>
  <img src="./imagenes/07/072/015.png" width="750"/>
</figure> -->

<ol start="2">
<li>A continuación se necesita detener varios servicios instalados con anterioridad y que ahora serán
gestionados a través de Samba. Se paran y se deshabilitan.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># stop and disable samba services - smbd, nmbd, and winbind</span>
<span class="linenos" data-linenos="2 "></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>disable<span class="w"> </span>--now<span class="w"> </span>smbd<span class="w"> </span>nmbd<span class="w"> </span>winbind
</code></pre></div>
<ol start="3">
<li>Se activa el servicio <strong>samba-ad-dc</strong> mediante los siguientes comandos:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>systemctl<span class="w"> </span>unmask<span class="w"> </span>samba-ad-dc
<span class="linenos" data-linenos="2 "></span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>samba-ad-dc
</code></pre></div>
<figure>
  <img src="./imagenes/067/007G.gif"/>
  <figcaption>Instalación samba y paquetes necesarios.</figcaption>
</figure>

<!-- <figure>
  <img src="./imagenes/07/072/016.png" width="750"/>
</figure> -->

<h2 id="configuracion-samba-dc">Configuración Samba-DC<a class="headerlink" href="#configuracion-samba-dc" title="Permanent link">&para;</a></h2>
<ol>
<li>Antes de pasar a configurar Samba, es conveniente guardar el fichero de configuración original, por si hubiera que retomar la instalación desde este punto:</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>mv<span class="w"> </span>/etc/samba/smb.conf<span class="w"> </span>/etc/samba/smb.conf.copia
</code></pre></div>
<ol start="2">
<li>El siguiente paso es configurar el controlador de dominio de <code>Samba</code> mediante el uso de samba-tool.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>samba-tool<span class="w"> </span>domain<span class="w"> </span>provision<span class="w"> </span>--use-rfc2307<span class="w"> </span>--interactive
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<ul>
<li>Dentro de la configuración cogerá el <strong>reino/dominio</strong> del servidor, por lo tanto no se tiene que rellenar nada, <strong>excepto la parte de DNS forwarder que se usará Quad9, el cual es DNS recursivo público global que tiene como objetivo proteger a los usuarios del malware y el phishing. (9.9.9.9)</strong>.</li>
<li>La razón de esta configuración es porque el servidor actuará como DNS, pero si no se puede resolver una página pasaremos la solicitud de resolución al servidor DNS forwarder (9.9.9.9).</li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Advertencia</p>
<p>Como <strong>contraseña</strong> de administrador necesita tener una <strong>mayúscula/minúscula/número/longitud de 8</strong>. El usuario por defecto es “administrator”, en este caso se usará <strong>AsoAula5</strong></p>
</div>
<ul>
<li>Si todo ha salido bien, se creará el fichero <code>smb.conf</code> acorde con la configuración:</li>
</ul>
<figure>
  <img src="./imagenes/067/009G.gif"/>
  <figcaption>Configuración Samba y comprobación.</figcaption>
</figure>

<!-- <figure>
  <img src="./imagenes/07/072/017.png" width="750"/>
</figure> -->

<ul>
<li><strong>[global]</strong>: Donde se puede observar todos los datos de configuración del dominio, además de los
roles para los que se ha creado (DC-AD).</li>
<li><strong>[netlogon]</strong>: Ya ha creado de forma automática la carpeta para los scripts de inicio de sesión de
los clientes.</li>
<li><strong>[sysvol]</strong>: El sysvol es reponsable de replicar las GPOs (Políticas de Grupos) aplicadas en el editor
de directivas de grupo, todos los cambios y GPOs nuevos son replicados por allí.</li>
</ul>
<ol start="3">
<li>Ahora se instala Kerberos, antes solo se había asociado la configuración a <code>Samba</code> (reino, dns, password, etc). Para ello se realiza una copia de seguridad de la configuración actual y se sobrescribe la realizada por Samba.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># Renombra la configuración por defecto de Kerberos a krb5.conf.original</span>
<span class="linenos" data-linenos="2 "></span>sudo<span class="w"> </span>mv<span class="w"> </span>/etc/krb5.conf<span class="w"> </span>/etc/krb5.conf.original
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="c1"># Copia la configuración generada samba-tool</span>
<span class="linenos" data-linenos="5 "></span>sudo<span class="w"> </span>cp<span class="w"> </span>/var/lib/samba/private/krb5.conf<span class="w"> </span>/etc/krb5.conf
</code></pre></div>
<figure>
  <img src="./imagenes/067/010G.gif"/>
  <figcaption>Configuración Kerberos.</figcaption>
</figure>

<ol start="4">
<li>Se incializa el servicio de Samba</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># start samba-ad-dc service</span>
<span class="linenos" data-linenos="2 "></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>samba-ad-dc
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="c1"># verify samba-ad-dc service</span>
<span class="linenos" data-linenos="5 "></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>samba-ad-dc
</code></pre></div>
<figure>
  <img src="./imagenes/067/011G.gif"/>
  <figcaption>Inicia Samba y comprueba.</figcaption>
</figure>

<!-- <figure>
  <img src="./imagenes/07/072/018.png" width="750"/>
</figure> -->

<ol start="5">
<li>Se configura la sincronización del tiempo para que el servidor este en hora, con el objetivo de realizar de forma adecuada tareas de resolución de incidencias.</li>
</ol>
<p>5.1. Se establecen los permisos para NTP (Network Time Protocol). En la instalación de Samba se utilizó el paquete <code>chrony</code>, el cual es una implementación del Network Time Protocol. Es una alternativa a ntpd, que es una implementación de referencia de NTP. A continuación se muestran los comando para dar los permisos adecuados a <code>chrony</code>.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># Permite al grupo _chrony leer en el directorio ntp_signd</span>
<span class="linenos" data-linenos="2 "></span>sudo<span class="w"> </span>chown<span class="w"> </span>root:_chrony<span class="w"> </span>/var/lib/samba/ntp_signd/
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="c1"># Cambia los permisos en el directorio ntp_signd.</span>
<span class="linenos" data-linenos="5 "></span>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">750</span><span class="w"> </span>/var/lib/samba/ntp_signd/
</code></pre></div>
<p>5.2 Configuración de <code>Chrony</code>, dentro del archivo de configuración <code>/etc/chrony/chrony.conf</code> se añaden las siguientes líneas:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># bind el servicio de chrony a la dirección IP del Samba AD.</span>
<span class="linenos" data-linenos="2 "></span>bindcmdaddress<span class="w"> </span><span class="m">192</span>.168.2.4
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="c1"># Permite a los clientes de la red conectar al Chrony NTP server en este caso:</span>
<span class="linenos" data-linenos="5 "></span>allow<span class="w"> </span><span class="m">192</span>.168.2.0/24
<span class="linenos" data-linenos="6 "></span>
<span class="linenos" data-linenos="7 "></span><span class="c1"># Especifica el directorio del ntpsigndsocket para el Samba AD.</span>
<span class="linenos" data-linenos="8 "></span>ntpsigndsocket<span class="w"> </span>/var/lib/samba/ntp_signd
</code></pre></div>
<p>5.3 Se reinicia el servicio y se comprueba su estado.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># Reinicia el servicio chronyd.</span>
<span class="linenos" data-linenos="2 "></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>chronyd
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="c1"># Verifica el estado de chronyd</span>
<span class="linenos" data-linenos="5 "></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>chronyd
</code></pre></div>
<figure>
  <img src="./imagenes/067/012G.gif"/>
  <figcaption>Instalación y configuración de <b>chronyd.</b></figcaption>
</figure>

<h2 id="comprobacion-del-samba-active-directory">Comprobación del Samba Active Directory<a class="headerlink" href="#comprobacion-del-samba-active-directory" title="Permanent link">&para;</a></h2>
<ol>
<li>Verificaciones del dominio.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># Verifica el Dominio</span>
<span class="linenos" data-linenos="2 "></span>host<span class="w"> </span>-t<span class="w"> </span>A<span class="w"> </span>aso.local
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="c1"># Verifica el FQDN</span>
<span class="linenos" data-linenos="5 "></span>host<span class="w"> </span>-t<span class="w"> </span>A<span class="w"> </span>profesor.aso.local
</code></pre></div>
<ol start="2">
<li>Comprobación de <code>Kerberos</code> y <code>ldap</code>.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># Comprobación del registro SRV para _kerberos. </span>
<span class="linenos" data-linenos="2 "></span>host<span class="w"> </span>-t<span class="w"> </span>SRV<span class="w"> </span>_kerberos._udp.aso.local
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="c1"># Comprobación del registro SRV para _ldap</span>
<span class="linenos" data-linenos="5 "></span>host<span class="w"> </span>-t<span class="w"> </span>SRV<span class="w"> </span>_ldap._tcp.aso.local
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">NOTA</p>
<p>El registro <code>SRV</code> es un registro de recursos del sistema de nombres de dominio (<code>DNS</code>). Se usa para identificar equipos que hospedan servicios.</p>
</div>
<ol start="3">
<li>Comprobar el <code>login</code> con el usuario <code>administrator</code> con el comando <code>kinit</code>.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># Autenticate a Kerberos con el usuario administrator.</span>
<span class="linenos" data-linenos="2 "></span>kinit<span class="w"> </span>administrator@ASO.LOCAL
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="c1"># Verifica la lista de accesos.</span>
<span class="linenos" data-linenos="5 "></span>klist
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Cuidado</p>
<p>A tener en cuenta las mayúsculas del dominio en el comando <code>kinit</code>.</p>
</div>
<figure>
  <img src="./imagenes/067/013G.gif"/>
  <figcaption>Comprobaciones</figcaption>
</figure>

<h2 id="creacion-y-acceso-de-usuarios">Creación y acceso de usuarios<a class="headerlink" href="#creacion-y-acceso-de-usuarios" title="Permanent link">&para;</a></h2>
<p>Existen diferentes formas de crear usuarios, se destacan dos:</p>
<ol>
<li>Mediante comandos de <code>Samba</code>.</li>
<li>A través de la herramienta de gestión <code>RSAT</code>.</li>
</ol>
<p>A continuación se describen ambos métodos:</p>
<h3 id="crear-usuario-con-samba-tool">Crear usuario con samba-tool<a class="headerlink" href="#crear-usuario-con-samba-tool" title="Permanent link">&para;</a></h3>
<ul>
<li>En este caso se utiliza los comandos de samba-tool para crear el usuario:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c1"># Crea un nuevo usuario en Samba.</span>
<span class="linenos" data-linenos="2 "></span>sudo<span class="w"> </span>samba-tool<span class="w"> </span>user<span class="w"> </span>create<span class="w"> </span>javi
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="c1"># Comprueba los usuarios de Samba.</span>
<span class="linenos" data-linenos="5 "></span>sudo<span class="w"> </span>samba-tool<span class="w"> </span>user<span class="w"> </span>list
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Como se ha explicado en secciones anteriores los usuarios creado en <code>Samba</code> deben estar creados también en el sistema.</p>
</div>
<h2 id="acceso-al-samba-dc-desde-un-windows-client">Acceso al Samba-DC desde un Windows Client<a class="headerlink" href="#acceso-al-samba-dc-desde-un-windows-client" title="Permanent link">&para;</a></h2>
<h3 id="configuracion-de-dns-y-comprobacion">Configuración de DNS y comprobación<a class="headerlink" href="#configuracion-de-dns-y-comprobacion" title="Permanent link">&para;</a></h3>
<ul>
<li>Se accede al cliente, en este caso <strong>Windows 10</strong> y se configuran los <code>DNS</code> del <code>Samba-DC</code>.</li>
</ul>
<figure>
  <img src="./imagenes/067/014G.gif"/>
  <figcaption>Configuración DNS de Samba-DC en WinClient.</figcaption>
</figure>

<ul>
<li>Por otro lado se pueden comprobar los DNS mediante comandos de PowerShell.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c"># En Powershell</span>
<span class="linenos" data-linenos="2 "></span><span class="nb">Get-DnsClientServerAddress</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="c"># ping al AD domain profesor.aso.local</span>
<span class="linenos" data-linenos="5 "></span><span class="n">ping</span> <span class="n">profesor</span><span class="p">.</span><span class="n">aso</span><span class="p">.</span><span class="n">local</span>
<span class="linenos" data-linenos="6 "></span>
<span class="linenos" data-linenos="7 "></span><span class="c"># ping al AD domain aso.local</span>
<span class="linenos" data-linenos="8 "></span><span class="n">ping</span> <span class="n">aso</span><span class="p">.</span><span class="n">local</span>
</code></pre></div>
<figure>
  <img src="./imagenes/067/015G.gif"/>
  <figcaption>Comprobación DNS con PowerShell.</figcaption>
</figure>

<h3 id="anadir-cliente-al-active-directory-con-powershell">Añadir cliente al Active Directory con PowerShell<a class="headerlink" href="#anadir-cliente-al-active-directory-con-powershell" title="Permanent link">&para;</a></h3>
<ul>
<li>El siguiente paso es añadir el Cliente al Controlador de Dominio, y en este caso lo vamos a hacer por PowerShell con el siguiente comando:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="c"># Añade Windows 10 al Active Directory usando POWERSHELL</span>
<span class="linenos" data-linenos="2 "></span><span class="nb">Add-Computer</span> <span class="n">-DomainName</span> <span class="s2">&quot;aso.local&quot;</span> <span class="n">-Restart</span>
</code></pre></div>
<figure>
  <img src="./imagenes/067/016G.gif"/>
  <figcaption>Añadir cliente al dominio mediante PowerShell.</figcaption>
</figure>

<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Al reiniciar debe aparecer el login para el Dominio.</p>
</div>
<ul>
<li>Comprobación de usuarios en el DC desde el Windows Client.</li>
</ul>
<figure>
  <img src="./imagenes/067/017G.gif"/>
  <figcaption>Comprobación usuarios desde W10.</figcaption>
</figure>

<h2 id="descargar-y-activar-la-aplicacion-rsat">Descargar y Activar la Aplicación RSAT<a class="headerlink" href="#descargar-y-activar-la-aplicacion-rsat" title="Permanent link">&para;</a></h2>
<p><strong>RSAT</strong> (Remote Server Administration Tools) es una aplicación cuyo objetivo es administrar el servidor
pensada para instalarse en clientes que replica las herramientas disponibles en el controlador del dominio.</p>
<p>La aplicación se puede descargar del siguiente enlace <a href="https://www.microsoft.com/es-ES/download/details.aspx?id=45520">RSAT</a></p>
<ul>
<li>Se descarga e instala:</li>
</ul>
<figure>
  <img src="./imagenes/067/018G.gif"/>
  <figcaption>Descarga e instalación de RSAT en W10.</figcaption>
</figure>

<div class="admonition note">
<p class="admonition-title">Nota</p>
<ul>
<li>Se debe reiniciar para que aparezca en herramientas administrativas, las aplicaciones del AD.</li>
</ul>
</div>
<ul>
<li>Otra opción de instalación de diferentes paquetes.</li>
</ul>
<figure>
  <img src="./imagenes/067/019G.gif"/>
  <figcaption>Herramientas del AD.</figcaption>
</figure>

<figure>
  <img src="./imagenes/067/020G.gif"/>
  <figcaption>Herramientas del AD II.</figcaption>
</figure>

<h2 id="acceso-samba-dc-desde-un-fedora">Acceso Samba-DC desde un fedora<a class="headerlink" href="#acceso-samba-dc-desde-un-fedora" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Ubuntu Server</p>
<p>En el Ubuntu Server es necesario añadir repositorios.</p>
</div>
<ol>
<li><strong>En Ubuntu Server</strong>, es necesario añadir los repositorios del "Universe".</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>add-apt-repository<span class="w"> </span>universe
<span class="linenos" data-linenos="2 "></span>sudo<span class="w"> </span>add-apt-repository<span class="w"> </span>multiverse
<span class="linenos" data-linenos="3 "></span>sudo<span class="w"> </span>apt<span class="w"> </span>update
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Cliente</p>
<p>En el cliente.</p>
</div>
<ol start="2">
<li>Se Establece nombre de host.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>hostnamectl<span class="w"> </span>set-hostname<span class="w"> </span>fedora.aso.local
</code></pre></div>
<ol start="3">
<li>En Fedora, se edita la configuración Resolved.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>nano<span class="w"> </span>/etc/systemd/resolved.conf
<span class="linenos" data-linenos="2 "></span>
<span class="linenos" data-linenos="3 "></span><span class="c1"># Añade las siguientes líneas</span>
<span class="linenos" data-linenos="4 "></span><span class="o">[</span>Resolve<span class="o">]</span>
<span class="linenos" data-linenos="5 "></span><span class="nv">DNS</span><span class="o">=</span><span class="m">192</span>.168.2.4<span class="w"> </span><span class="m">9</span>.9.9.9<span class="w"> </span><span class="m">8</span>.8.8.8
<span class="linenos" data-linenos="6 "></span>
<span class="linenos" data-linenos="7 "></span><span class="c1"># Guarda y reinicia el servicio.</span>
<span class="linenos" data-linenos="8 "></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>systemd-resolved
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Ubuntu Server</p>
<p>De nuevo en el Ubuntu Server es necesario añadir unos paquetes.</p>
</div>
<ol start="4">
<li>Se Instalan los paquetes necesarios (<strong>solo Ubuntu</strong>)</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>apt<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>realmd<span class="w"> </span>libnss-sss<span class="w"> </span>libpam-sss<span class="w"> </span>sssd<span class="w"> </span>sssd-tools<span class="w"> </span>adcli<span class="w"> </span>samba-common-bin<span class="w"> </span>oddjob<span class="w"> </span>oddjob-mkhomedir<span class="w"> </span>packagekit
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Cliente</p>
<p>Ya en el cliente.</p>
</div>
<ol start="5">
<li>(Opcional) Descubrir dominio.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>realm<span class="w"> </span>discover<span class="w"> </span>aso.local
</code></pre></div>
<ol start="6">
<li>Se añade al dominio.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>realm<span class="w"> </span>join<span class="w"> </span>-U<span class="w"> </span>Administrator<span class="w"> </span>aso.local
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Al reiniciar el cliente se podrá iniciar sesión como usuario del dominio.</p>
</div>
<!-- -------------------------------------------------------------------------------------------------------- -->
<!-- 17. A continuación copiamos la configuración de kerberos para samba por la configuración por defecto de kerberos:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">cp /var/lib/samba/private/krb5.conf /etc/krb5.conf</span>
</code></pre></div>

18. Detemos system-resolved para que no nos manipule automáticamente el fichero `/etc/resolv.conf`

<figure>
  <img src="./imagenes/07/072/019.png" width="750"/>
</figure>

19. Finalmente comprobamos que la configuración de Kerberos está bien:

<figure>
  <img src="./imagenes/07/072/020.png" width="750"/>
</figure>

20. Como ya tenemos configurado el DNS forwarder, volvemos a nuestra configuración de red y cambiamos el servidor DNS como a nosotros mismos, para resolver las peticiones de nuestro dominio. Acordaros del netplan apply.

<figure>
  <img src="./imagenes/07/072/021.png" width="750"/>
</figure>

Finalmente podemos ver el resumen de nuestro dominio:

<figure>
  <img src="./imagenes/07/072/022.png" width="750"/>
</figure>

Comprobamos que funciona la resolución al dominio:

<figure>
  <img src="./imagenes/07/072/023.png" width="750"/>
</figure>


## Agregar un cliente Windows al dominio de Samba.

### Crear Usuario en el Controlador de Dominio

Lo primero será tener un usuario válido para acceder al dominio, para ello vamos a nuestro servidor que hace de controlador de dominio y creamos dicho usuario:

!!! tip "**Redorcatorio**"
    Recuerda a la hora de insertar la contraseña que debe cumplir con un mínimo de 8 caracteres, una mayúscula, una minúscula y un número.

<figure>
  <img src="./imagenes/07/072/024.png" width="850"/>
</figure>

- Para el usuario “niko” se ha creado la contraseña “Niko1234#”

<figure>
  <img src="./imagenes/07/072/025.png" width="750"/>
</figure>

!!! note "**NOTA:**"
    A diferencia de lo que pasaba en samba, cuando NO era un controlador de dominio, el usuario no es necesario que exista en el sistema y además los UID no son iguales a los del sistema operativo.

<figure>
  <img src="./imagenes/07/072/026.png" width="550"/>
</figure>

### Añadir el Cliente Windows al Dominio Samba.

1. Añade al cliente en la misma red interna que el controlador de dominio de SAMBA, en nuestro caso una `“NAT Network”`. Ésta red se le asignará una IP automática y una puerta de enlace, pero debemos forzarle que el servidor DNS sea nuestro controlador de dominio.

!!! note "**NOTA:**"
    En una situación real, el propio controlador de dominio actuaría de servidor DHCP, o en el caso de tener un servicio DHCP ya asignaría el DNS automáticamente del controlador de dominio, por lo que no habría que hacer este paso.

<figure>
  <img src="./imagenes/07/072/027.png" width="550"/>
  <figcaption>Configuración de Propiedades de Red en Windows.</figcaption>
</figure>

<figure>
  <img src="./imagenes/07/072/028.png" width="550"/>
  <figcaption>Comprobación conexión con Server.</figcaption>
</figure>

2. Vamos a introducir el cliente dentro de nuestro dominio:

  - Botón derecho – Propiedades sobre el icono de `“Equipo”`.
  - Pinchar en `“Cambiar Configuración”`.
  - Posteriormente le damos a `“cambiar..”` y seleccionamos nuestro dominio.

<figure>
  <img src="./imagenes/07/072/029.png" width="850"/>
  <figcaption>Propiedades Equipo.</figcaption>
</figure>

<figure>
  <img src="./imagenes/07/072/030.png" width="850"/>
  <figcaption>Cambio para sellecionar dominio.</figcaption>
</figure>

!!! note "**NOTA:**"
  Es muy importante que accedamos con un usuario con permisos de administrador en el servidor linux, si os acordáis Kerberos es el servicio que se encarga de la seguridad de nuestro controlador de dominio, y por defecto éste crea el usuario `“administrator”`.

<figure>
  <img src="./imagenes/07/072/031.png" width="550"/>
  <figcaption>Cambio de usuario a Administrador.</figcaption>
</figure>

<figure>
  <img src="./imagenes/07/072/032.png" width="850"/>
  <figcaption>Confirmación cambio Dominio.</figcaption>
</figure>

- Finalmente reiniciamos el equipo cliente e intentamos acceder con un usuario del controlador de dominio, como por ejemplo “niko”, fijaros que es un usuario que no existe en el Windows a nivel local, existe en el servidor, por lo que “niko” se podría registrar en cualquier equipo asociado al dominio.

<figure>
  <img src="./imagenes/07/072/033.png" width="550"/>
  <figcaption>Comprobación de Logueo.</figcaption>
</figure>

## Compartir recursos en un dominio entre Windows y Servidor Ubuntu.

A la hora de compartir recursos es prácticamente igual a cuando se realizaba en Samba sin directorio activo.

1. Crear la carpeta a compartir y darle permisos requeridos.
2. Acceder al fichero de configuración de samba.
3. Generar un recurso a compartir.

<figure>
  <img src="./imagenes/07/072/034.png" width="350"/>
  <figcaption>Ejemplo recurso compartido.</figcaption>
</figure>

4. Reiniciar el servicio.
  1. Ahora el servicio de **samba** esta configurado como directorio activo podemos hacer:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">smbcontrol all reload-config</span>
</code></pre></div>

- Para que cualquier usuario del dominio pueda administrar un recurso podemos agregarle al recurso el grupo `“Domain Users”`, se puede comprobar que existe con el siguiente comando dentro de la base de datos de Samba.

<figure>
  <img src="./imagenes/07/072/035.png" width="750"/>
</figure>

### winbind

El problema que tendremos, la primera vez, es que ese grupo no tiene un **GID (identificador de grupo)** asociado del sistema operativo Ubuntu Server. Para ello vamos a usar `“winbind”` para que pueda traducir a partir de un grupo de samba a un grupo del sistema y hacer una equivalencia.

- Se instalan los paquetes:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">apt-get install libnss-winbind</span>
<span class="linenos" data-linenos="2 "></span><span class="l l-Scalar l-Scalar-Plain">apt-get install libpam-winbind</span>
</code></pre></div>

- Se modifica el fichero `“/etc/nsswitch.conf”` que revisa donde tiene que buscar el registro de `usuarios/grupos` del sistema. “Files” será su primera opción, que será `/etc/passwd` y `/etc/groups`, si no los encuentra ahí pasa a usar el servicio winbind para hacer la equivalencia con samba AD.

<figure>
  <img src="./imagenes/07/072/036.png" width="750"/>
</figure>

- Finalmente se puede comprobar que funciona y que cuando le preguntamos al sistema por el grupo del controlador de dominio `“Domain Users”` el sistema nos indica que es capaz de relacionarlo con un identificador de grupo, en este caso el `100`.

<figure>
  <img src="./imagenes/07/072/037.png" width="750"/>
</figure>

- En el ejemplo se ve que el usuario del dominio niko pertenece al grupo 100 que es el de domain users.

<figure>
  <img src="./imagenes/07/072/038.png" width="750"/>
</figure>

- Finalmente se añaden todas las carpetas a compartir y sus rutas padres al grupo del dominio:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">chgrp -R &quot;Domain Users&quot; /recursosSOR</span>
<span class="linenos" data-linenos="2 "></span><span class="l l-Scalar l-Scalar-Plain">chmod 2750recursosSOR</span>
</code></pre></div>

!!! note "**NOTA:**"
    Si se había iniciado sesión con tu usuario de Windows 10 antes de cambiar la configuración de `/etc/nsswitch`, cierra sesión y vuelve a acceder.

- En el `cliente Windows 10` que ya está unido al dominio deberemos:

1. Comprobar que navega por Internet.
2. Acceder a una `carpeta/directorio` y buscar el nombre de tu equipo que está compartiendo el recurso, en este caso es el propio servidor.

<figure>
  <img src="./imagenes/07/072/039.png" width="850"/>
</figure>

!!! note "**NOTA:**"
    No debería pedir credenciales, porque ya habíamos iniciado sesión como “niko” en este ordenador que pertenece al dominio y a Domain Users.

- Además, desde las propiedades de seguridad del cliente Windows podemos cambiar las **políticas de acceso de esa carpeta compartida** (siempre que tengamos permisos en el servidor para ello).

<figure>
  <img src="./imagenes/07/072/040.png" width="850"/>
</figure>

## Activar RSAT

Se debe aplicar a `Aplicaciones y Características` – `Características Opcionales` y se agrega una nueva característica:

<figure>
  <img src="./imagenes/07/072/041.png" width="850"/>
  <figcaption>Características Opcionales.</figcaption>
</figure>

<figure>
  <img src="./imagenes/07/072/042.png" width="550"/>
  <figcaption>Agregar una Característica.</figcaption>
</figure>

- Para agregar filtramos por **RSAT** y activamos:

<figure>
  <img src="./imagenes/07/072/043.png" width="850"/>
  <figcaption>Agregar RSAT.</figcaption>
</figure>

## Perfiles Móviles.

Un perfil móvil, es aquel donde un usuario se registre en la máquina que se registre, si ésta pertenece al dominio, tendrá sus ficheros personales con los que trabaja día a día.

### Configuración de Políticas de Cliente

Como administradores, si queremos implementar perfiles móviles, tenemos dos opciones.

1. Indicar que el perfil de cada usuario debe apuntar al servidor, en nuestro caso el **samba ubuntu server**.
2. Crear una política de grupo para que cada usuario que acceda a dicha máquina directamente se le genere el perfil adecuado.

!!! note "**NOTA:**"
    Obviamente, la solución b) es mucho más escalable y por tanto más adecuada.

#### OPCIÓN 1

1. Entra al cliente Windows como Administrador (**Administrator**).
2. Por curiosidad, ahora puedes ir a `“Usuarios y Equipos de Active Directory”` y ver/gestionar los grupos del directorio activo desde el propio Windows.
3. En las propiedades del usuario y luego en su perfil:

<figure>
  <img src="./imagenes/07/072/044.png" width="850"/>
  <figcaption>Usuarios y Equipos.</figcaption>
</figure>

<figure>
  <img src="./imagenes/07/072/045.png" width="550"/>
  <figcaption>Propiedades niko.</figcaption>
</figure>

#### OPCIÓN 2

1. Entra al cliente Windows como Administrador (**Administrator**).
2. Accede a la administración de directivas de grupo (GPO).
3. Crea una **GPO** asociado al dominio.

<figure>
  <img src="./imagenes/07/072/046.png" width="850"/>
  <figcaption>Creamos GPO.</figcaption>
</figure>

4. Editamos la nueva política creada.

<figure>
  <img src="./imagenes/07/072/047.png" width="550"/>
  <figcaption>Editar nueva política.</figcaption>
</figure>

5. Ahora Navegamos por `Configuración del Equipo` &#8594 `Directivas` &#8594` Plantillas Administrativas` &#8594 `Sistema` &#8594 `Perfiles de Usuario.`

- Dentro de Perfiles de Usuario seleccionamos la plantilla sobre perfiles móviles para todos los usuarios conectados al equipo.

<figure>
  <img src="./imagenes/07/072/048.png" width="850"/>
  <figcaption>Establecer Perfil móvil.</figcaption>
</figure>

<figure>
  <img src="./imagenes/07/072/049.png" width="850"/>
  <figcaption>Ruta para Perfil móvil.</figcaption>
</figure>

- Una vez modificado la política, ésta se actualiza en el servidor (Ubuntu Server) n la ruta `Sysvol`. Es decir si vamos al fichero de configuración de Samba, vemos que hay un recurso compartido llamado `sysvol`.

<figure>
  <img src="./imagenes/07/072/050.png" width="450"/>
  <figcaption>Ruta sysvol.</figcaption>
</figure>

- Si investigamos dentro de esa carpeta vemos que hay una sección de Políticas que justo se ha creado al mismo momento que hemos aplicado las políticas:

<figure>
  <img src="./imagenes/07/072/051.png" width="950"/>
  <figcaption>Confirmación Ruta.</figcaption>
</figure>

### Confirmación de Recursos

- Se debe crear la carpeta donde se almacenarán los recursos de los usuarios y Configurar acceso a cualquier usuario perteneciente al grupo de administradores del dominio:

<figure>
  <img src="./imagenes/07/072/052.png" width="850"/>
</figure>

- Posteriormente lo agregamos como un recurso a compartir:

<figure>
  <img src="./imagenes/07/072/053.png" width="350"/>
</figure>

- Reiniciamos el servicio:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="l l-Scalar l-Scalar-Plain">smbcontrol all reload-config</span>
</code></pre></div>

- Desde Windows (que es más visible) gestionamos los permisos de los perfiles de los usuarios, para ello accedemos a `\\profesor` y a las propiedades de “profiles”:

Si queremos agregar algún grupo/usuario que no esté, como podría ser Domain Users:

<figure>
  <img src="./imagenes/07/072/054.png" width="850"/>
</figure>

- Una vez tengamos agregados todos los grupos que queremos , vamos a filtrar e indicar los permisos de cada uno.

<figure>
  <img src="./imagenes/07/072/055.png" width="550"/>
</figure>

- Opciones de Compartición:

<figure>
  <img src="./imagenes/07/072/056.png" width="850"/>
</figure>

- Opciones de Seguridad:

<figure>
  <img src="./imagenes/07/072/057.png" width="850"/>
</figure>

<figure>
  <img src="./imagenes/07/072/058.png" width="850"/>
</figure>

### Acceso desde el usuario

Ahora cada vez que nos registremos en cualquier ordenador del dominio, aunque sea la primera vez, ya tendremos configurada una carpeta compartida en nuestro perfil para nosotros solos (y los administradores).

<figure>
  <img src="./imagenes/07/072/059.png" width="850"/>
</figure>

### Redirección

Entre sistemas Linux sí se podía direccionar directamente el `/home` de un usuario a una carpeta del servidor `[homes]`. En el caso de Windows debemos realizar una redirección.

1. Accedemos como “**administrator**”.
2. Accede a la administración de directivas de grupo (**GPO**).
3. Crea una **GPO** asociado al dominio.

<figure>
  <img src="./imagenes/07/072/060.png" width="850"/>
</figure>

4. Editamos la nueva política creada.

<figure>
  <img src="./imagenes/07/072/061.png" width="550"/>
</figure>

5. Accedemos a las propiedades de la carpeta que queremos redireccionar:

<figure>
  <img src="./imagenes/07/072/062.png" width="850"/>
</figure>

<figure>
  <img src="./imagenes/07/072/063.png" width="850"/>
</figure>

6. Cerramos sesión y Registramos con otro usuario no administrador.

Una vez registrados creamos unos ficheros en el escritorio o carpetas, como si estuvieramos trabajando y cerramos la sesión.

Al cerrar la sesión se migran los ficheros al servidor y si nos conectáramos a cualquier otra máquina tendríamos nuestro Escritorio y ficheros con nosotros.

<figure>
  <img src="./imagenes/07/072/064.png" width="850"/>
</figure>

!!! tip "**A tener en cuenta**"
    Obviamente en la empresa, en caso de tener un AD con Samba como DC, no hará falta configurar cada cliente Windows (crear las políticas, etc), si no que usaremos una imagen, creada por ejemplo con clonezilla, y distribuiremos esa imagen con las políticas ya configuradas a todas las máquinas. -->









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2023-2024 Francisco Javier Hernández Illán - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="mailto:<fj.hernandez@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48H48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0L0 176z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/fjavier-hernandez-illan" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  




  


<h4>Consentimiento de cookie</h4>
<p>Esta página de apuntes utiliza cookies para reconocer las visitas, medir la efectividad de la documentación y averiguar si encuentras aquello que buscas o cómo has llegado a estos apuntes. Con tu consentimiento, me ayudas a mejorar estos materiales.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Aceptar</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Gestionar cookies</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["header.autohide", "toc.integrate", "navigation.indexes", "navigation.top", "navigation.tracking", "toc.follow"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>