
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Creación de Usuarios y grupos en Samba de Francisco Javier Hernández Illán.">
      
      
      
        <link rel="canonical" href="https://github.com/fjavier-hernandez/sor/03_USERS_SAMBA/032_CreacionUsersSamba.html">
      
      
        <link rel="prev" href="031_SambaSecUsers.html">
      
      
        <link rel="next" href="035_Actividades.html">
      
      
      <link rel="icon" href="../imagenes/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>Creación de Usuarios y grupos en Samba - Sistemas Operativos en Red</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-0CPJP88MBF"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-0CPJP88MBF",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-0CPJP88MBF",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="javi" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#creacion-de-usuarios-y-grupos" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../index.html" title="Sistemas Operativos en Red" class="md-header__button md-logo" aria-label="Sistemas Operativos en Red" data-md-component="logo">
      
  <img src="../imagenes/SOR_logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Sistemas Operativos en Red
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Creación de Usuarios y grupos en Samba
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="javi" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Sistemas Operativos en Red" class="md-nav__button md-logo" aria-label="Sistemas Operativos en Red" data-md-component="logo">
      
  <img src="../imagenes/SOR_logo.png" alt="logo">

    </a>
    Sistemas Operativos en Red
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../SituacionAprendizaje.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Situación de Aprendizaje
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Evaluacion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evaluación
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    1.- Instalación de Sistemas Operativos en red.
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            1.- Instalación de Sistemas Operativos en red.
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_INTRO_SOR/001_IntroSOR.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.1- Introducción a Sistemas Operativos en Red
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_INTRO_SOR/002_Virtualizaci%C3%B3n.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.2- Virtualización
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_INTRO_SOR/006_Instalacion.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.3- Instalación de Sistemas Operativos en Red
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01_INTRO_SOR/007_Practica.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.4- Actividades
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2.- Introducción a Servicio de directorio y Samba.
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            2.- Introducción a Servicio de directorio y Samba.
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_INTRO_SAMBA/020_Introduccion_SD.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.1- Introducción Servicio de directorio.
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_INTRO_SAMBA/021_IntroSamba.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.2- Introducción Samba
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_INTRO_SAMBA/022_InstalacionSamba.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.3- Instalación y configuración inicial Samba
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02_INTRO_SAMBA/025_Actividades.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.4- Actividades
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    3.- Administración de usuarios y grupos en Samba
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            3.- Administración de usuarios y grupos en Samba
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="031_SambaSecUsers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.1- Secciones y Usuarios Samba
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    3.2- Creación de Usuarios y grupos en Samba
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="032_CreacionUsersSamba.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    3.2- Creación de Usuarios y grupos en Samba
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#automatizacion" class="md-nav__link">
    <span class="md-ellipsis">
      Automatización
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scripting" class="md-nav__link">
    <span class="md-ellipsis">
      Scripting
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-de-contrasenas-samba" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración de contraseñas samba
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configuración de contraseñas samba">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#principales-argumentos-del-comando-chage" class="md-nav__link">
    <span class="md-ellipsis">
      Principales argumentos del comando chage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="035_Actividades.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.3- Actividades
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="creacion-de-usuarios-y-grupos">Creación de usuarios y grupos<a class="headerlink" href="#creacion-de-usuarios-y-grupos" title="Permanent link">&para;</a></h1>
<p>Como se ha comentado anteriormente es necesario crear los usuarios y los grupos en el sistema para posteriormente crearlos en la base de datos de Samba, cuando se tiene un número elevado de usuarios es necesario disponer de herramientas de automatización del proceso de generación de usuarios que se puede resumir en:</p>
<ol>
<li><strong>Grupos</strong>: Crear los grupos especificados si no existen.</li>
<li><strong>Usuarios</strong>: Crear los usuarios, les asigna una contraseña para el sistema, los agrega a un grupo y crea las cuentas correspondientes en Samba.</li>
<li><strong>Samba</strong>: Añade los usuarios a Samba y les asigna una contraseña.</li>
<li><strong>Reinicio de Samba</strong>: El servicio <code>smbd</code> de Samba se debe reiniciar para aplicar los cambios.</li>
</ol>
<h2 id="automatizacion">Automatización<a class="headerlink" href="#automatizacion" title="Permanent link">&para;</a></h2>
<p>Para automatizar dichos pasos se aconseja la utilización de scripting, a continuación se muestra un <strong>ejemplo general</strong> de script para realizar el proceso descrito:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="ch">#!/bin/bash</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="c1"># Listas de usuarios y grupos que deseas crear</span>
<span class="linenos" data-linenos=" 4 "></span><span class="nv">usuarios</span><span class="o">=(</span><span class="s2">&quot;usuario1&quot;</span><span class="w"> </span><span class="s2">&quot;usuario2&quot;</span><span class="w"> </span><span class="s2">&quot;usuario3&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="linenos" data-linenos=" 5 "></span><span class="nv">grupos</span><span class="o">=(</span><span class="s2">&quot;grupo1&quot;</span><span class="w"> </span><span class="s2">&quot;grupo2&quot;</span><span class="w"> </span><span class="s2">&quot;grupo3&quot;</span><span class="o">)</span><span class="p">;</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="c1"># Contraseña para los usuarios de Samba</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nv">samba_passwd</span><span class="o">=</span><span class="s2">&quot;Contraseña123&quot;</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="c1"># Crear grupos</span>
<span class="linenos" data-linenos="11 "></span><span class="k">for</span><span class="w"> </span>grupo<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">grupos</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="linenos" data-linenos="12 "></span><span class="w">  </span><span class="k">if</span><span class="w"> </span>getent<span class="w"> </span>group<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$grupo</span><span class="s2">&quot;</span><span class="w"> </span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="linenos" data-linenos="13 "></span><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;El grupo </span><span class="nv">$grupo</span><span class="s2"> ya existe.&quot;</span>
<span class="linenos" data-linenos="14 "></span><span class="w">  </span><span class="k">else</span>
<span class="linenos" data-linenos="15 "></span><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Creando grupo </span><span class="nv">$grupo</span><span class="s2">...&quot;</span>
<span class="linenos" data-linenos="16 "></span><span class="w">    </span>groupadd<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$grupo</span><span class="s2">&quot;</span>
<span class="linenos" data-linenos="17 "></span><span class="w">  </span><span class="k">fi</span>
<span class="linenos" data-linenos="18 "></span><span class="k">done</span>
<span class="linenos" data-linenos="19 "></span>
<span class="linenos" data-linenos="20 "></span><span class="c1"># Crear usuarios y añadirlos a los grupos</span>
<span class="linenos" data-linenos="21 "></span><span class="k">for</span><span class="w"> </span>usuario<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">usuarios</span><span class="p">[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="linenos" data-linenos="22 "></span><span class="w">  </span><span class="k">if</span><span class="w"> </span>id<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$usuario</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">&amp;</span>&gt;/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="linenos" data-linenos="23 "></span><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;El usuario </span><span class="nv">$usuario</span><span class="s2"> ya existe.&quot;</span>
<span class="linenos" data-linenos="24 "></span><span class="w">  </span><span class="k">else</span>
<span class="linenos" data-linenos="25 "></span><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Creando usuario </span><span class="nv">$usuario</span><span class="s2">...&quot;</span>
<span class="linenos" data-linenos="26 "></span><span class="w">    </span>useradd<span class="w"> </span>-m<span class="w"> </span>-s<span class="w"> </span>/bin/bash<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$usuario</span><span class="s2">&quot;</span>
<span class="linenos" data-linenos="27 "></span><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$usuario</span><span class="s2">:password&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>chpasswd
<span class="linenos" data-linenos="28 "></span>
<span class="linenos" data-linenos="29 "></span><span class="w">    </span><span class="c1"># Añadir el usuario a un grupo</span>
<span class="linenos" data-linenos="30 "></span><span class="w">    </span>usermod<span class="w"> </span>-aG<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">grupos</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$usuario</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># Puedes cambiar el grupo si lo deseas</span>
<span class="linenos" data-linenos="31 "></span><span class="w">  </span><span class="k">fi</span>
<span class="linenos" data-linenos="32 "></span>
<span class="linenos" data-linenos="33 "></span><span class="w">  </span><span class="c1"># Crear el usuario en Samba</span>
<span class="linenos" data-linenos="34 "></span><span class="w">  </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$samba_passwd</span><span class="s2">\n</span><span class="nv">$samba_passwd</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>smbpasswd<span class="w"> </span>-a<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$usuario</span><span class="s2">&quot;</span>
<span class="linenos" data-linenos="35 "></span><span class="w">  </span>smbpasswd<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$usuario</span><span class="s2">&quot;</span><span class="w">  </span><span class="c1"># Habilitar el usuario en Samba</span>
<span class="linenos" data-linenos="36 "></span><span class="k">done</span>
<span class="linenos" data-linenos="37 "></span>
<span class="linenos" data-linenos="38 "></span><span class="c1"># Reiniciar el servicio de Samba para aplicar cambios</span>
<span class="linenos" data-linenos="39 "></span>systemctl<span class="w"> </span>restart<span class="w"> </span>smbd
<span class="linenos" data-linenos="40 "></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Usuarios y grupos creados exitosamente en el sistema y en Samba.&quot;</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li><strong>getent</strong>: El comando <code>getent</code> (abreviatura de "get entries") recupera entradas de bases de datos específicas admitidas por NSS. Esto lo convierte en una herramienta versátil para buscar una amplia gama de información en un sistema Linux, incluidas cuentas de usuario, grupos, hosts, servicios y más.</li>
<li><strong>NSS</strong>: El Name Service Switch o NSS provee una interfaz para configurar y acceder a diferentes bases de datos de cuentas de usuarios y claves como /etc/passwd, /etc/group, /etc/hosts, LDAP, etc.</li>
</ul>
</div>
<h2 id="scripting">Scripting<a class="headerlink" href="#scripting" title="Permanent link">&para;</a></h2>
<p>La creación y generación de scripts o scripting se debe haber adquirido en <strong>Sistemas Operativos Monopuesto</strong>, módulo del primer curso, de todas formas a continuación se adjuntan apuntes de repaso de otros módulos para reforzar la creación de scripts:</p>
<ul>
<li><a href="https://salvasevero.github.io/sor/4_Scripts.html">Scripts SOR profesor Salvador Serrano</a></li>
<li><a href="https://fjavier-hernandez.github.io/aso/01_ShellScripting/011_ShellScript_Intro.html#shell">Scripting en ASO</a></li>
</ul>
<!-- 
## PT31 Creación de usuarios y grupos

!!! info "Contribución a los CEs (Criterios de Evaluación)"
    Estas actividades contribuyen a los criterios de evaluación CE1, CE2, CE3, CE4, CE5, CE6, CE7, y CE8 del RA2 de SOR.

!!! warning "Advertencia"
    Razona todas las respuestas, en caso de que la respuesta sea debido a unos permisos indica que permisos tiene y donde han sido determinados.

### Enunciado

Partiendo de la **situación de aprendizaje**, desde el departamento TIC de **NetOS** nos encargan crear la infraestructura de directorios y usuarios para los diferentes departamentos de una empresa de cría de berberechos salvajes denominada **BerbeWild S.A.** desde un sevidor linux **Ubuntu Server**. 

!!! note "**Nota**"
    Cabe destacar que el escenarios de la empresa es heterogéneo ya que existen diferentes tipos de sistemas operativos de propietarios (**Windows**) y libre licencia (**Lubuntu**).

- Por estas razones se decide utilizar el servicio **Samba** y realizar unos pasos previos siguiendo la guía adjunta a continuación:

!!! warning "Requisitos"
    Se necesitan las tres máquinas virtuales utilizadas en el apartado [2.2 Instalación y configuración inicial de Samba](https://fjavier-hernandez.github.io/sor/02_INTRO_SAMBA/022_InstalacionSamba.html) en configuración **Red NAT**.

!!! question "Tareas"
    - Esta práctica tiene como objetivo la creación de usuarios y grupos por un lado en el sistema y por otro en el servicio de directorio Samba, aunque inicialmente se debe crear la estructura de directorios de la organización.
    - A partir de las premisas adjunta realiza un video con los pasos realizados y un informe con los siguientes apartados.
    - Haz pruebas de inicio de sesión en al menos un cliente por departamento para comprobar que las cuentas funcionan.


### Premisas

1. **BerbeWild S.A.** esa posee una estructura en departamentos de esta forma:

* Un departamento encargado de la **gerencia** de la empresa. El sistema utilizado por este departamento es **Lubuntu 22_04**.
* Otro se encargará de la **administración** de la empresa. Es normal que ante la amplitud de tareas que este departamento posee se divida en varios sub-departamentos: **finanzas**, **nóminas** y **contabilidad.** Este departamento destaca por utilizar el sistema operativo **Windows 11**.
* Otra de las actividades que seguro necesitarás en tu empresa será la gestión de **mercadotécnia** con sistema operativo **Windows 11**.
* Además, debes contar con un buen **servicio técnico** que realice las tareas de diseño, implementación y mantenimiento de la infraestructura informática. El sistema utilizado por este departamento es **Lubuntu 22_04**.

!!! info "**Número de usuarios por departamento y rol**"
    Cada uno de estos departamentos posee dos empleados, uno de ellos será el responsable.

!!! note "**Nota**"
    Utiliza datos inventados para la información personal. Puedes usar esta web para obtener datos personales ficticios: [GeneraData](https://www.generatedata.com).

2. Crea un grupo por cada departamento y sub-departamento e introduce en ellos a cada uno de los usuarios que corresponda.

!!! example "**Ejemplo**"
    Los usuarios de **gerencia** en el grupo **gerencia**.

3. Los usuarios deben tener estas limitaciones:

* El usuario debe cambiar su contraseña en el siguiente inicio de sesión.
* El usuario no podrá cambiar la contraseña hasta que no transcurran 7 días desde la última vez que la modificó.
* Cualquier usuario debe cambiar su contraseña transcurridos treinta días.
* El sistema avisará con una semana de antelación del cambio de contraseña.

## Guía

El esquema de la organización es:

<figure>
  <img src="./imagenes/3001_EsquemaOrg.png"/>
</figure>

!!! tip "Consejo"
    Genera los directorios para la empresa, podrías utilizar el comando `mkdir -p /PATH`.

1. En un primer paso se crean los grupos y usuarios en el sistema para luego tenerlos "agregados también en el servicio de Samba". Se muestra la creación de dos usuarios en el sistema del departamento de servicio técnico a modo de ejemplo:

- Generación de grupo de servicio técnico "TIC":

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>groupadd<span class="w"> </span>TIC
</code></pre></div>

- Usuario administrador "responsable" debe tener permisos de superusuario:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>useradd<span class="w"> </span>admin<span class="w"> </span>-m<span class="w"> </span>-G<span class="w"> </span>sudo<span class="w"> </span>-s<span class="w"> </span>/bin/bash
</code></pre></div>

- Usuario "nivel bajo":

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>useradd<span class="w"> </span>usuario<span class="w"> </span>-m<span class="w"> </span>-g<span class="w"> </span>TIC<span class="w"> </span>-s<span class="w"> </span>/bin/bash
</code></pre></div>

Por otro lado, se generan los usuarios en Samba, los cuales se pueden realizar de dos formas:

- Mediante **smbpasswd**:

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>smbpasswd<span class="w"> </span>-a<span class="w"> </span>admin
</code></pre></div>

- A través de comandos de **samba-tool**.

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>samba-tool<span class="w"> </span>user<span class="w"> </span>create<span class="w"> </span>admin
</code></pre></div>

**Nota**: Este ejemplo se realiza para todos los usuarios planteados en la organización.

2. La creación de grupos también se realiza en el servicio samba mediante **samba-tool**.

- En el sistema.

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>samba-tool<span class="w"> </span>group<span class="w"> </span>add<span class="w"> </span>admin
</code></pre></div>

- Se añaden los usuarios al grupo.

<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>samba-tool<span class="w"> </span>group<span class="w"> </span>addmembers<span class="w"> </span>TIC<span class="w"> </span>usuario
</code></pre></div>
-->

<h2 id="configuracion-de-contrasenas-samba">Configuración de contraseñas samba<a class="headerlink" href="#configuracion-de-contrasenas-samba" title="Permanent link">&para;</a></h2>
<p>Para las restricciones de contraseña se puede realizar con el comando <code>chage</code>. El comando <code>chage</code> en Linux se utiliza para cambiar la información relacionada con la expiración de la contraseña de un usuario. Te permite ajustar cuándo caduca una contraseña, cuántos días antes de la expiración se debe advertir al usuario, entre otras configuraciones.</p>
<p>Sintaxis básica:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>chage<span class="w"> </span><span class="o">[</span>opciones<span class="o">]</span><span class="w"> </span>usuario
</code></pre></div></p>
<h3 id="principales-argumentos-del-comando-chage">Principales argumentos del comando chage<a class="headerlink" href="#principales-argumentos-del-comando-chage" title="Permanent link">&para;</a></h3>
<ul>
<li><code>-d</code> o <code>--lastday</code>: Establece el último día en que la contraseña fue cambiada. Se debe proporcionar la fecha en formato <strong>YYYY-MM-DD</strong> o en días desde el 1 de enero de 1970 (epoch).</li>
<li><code>-E</code> o <code>--expiredate</code>: Establece la fecha en la que la cuenta expira. Después de esa fecha, el usuario no podrá acceder al sistema. La fecha se especifica en el formato <strong>YYYY-MM-DD</strong> o con el número de días desde la época. </li>
<li><code>-I</code> o <code>--inactive</code>: Establece el número de días de inactividad después de la expiración de la contraseña, tras los cuales la cuenta será desactivada.</li>
<li><code>-m</code> o <code>--mindays</code>: Especifica el número mínimo de días que deben pasar antes de que el usuario pueda cambiar su contraseña nuevamente.</li>
<li><code>-M</code> o <code>--maxdays</code>: Establece el número máximo de días que puede pasar antes de que se requiera un cambio de contraseña.</li>
<li><code>-W</code> o <code>--warndays</code>: Define cuántos días antes de que expire la contraseña se advertirá al usuario de la expiración.</li>
<li><code>-l</code> o <code>--list</code>: Muestra el estado de la cuenta del usuario, incluyendo la fecha del último cambio de contraseña, cuándo expira, cuántos días faltan para el siguiente cambio obligatorio, etc.</li>
</ul>
<div class="admonition example">
<p class="admonition-title"><strong>Ejemplos</strong></p>
</div>
<ul>
<li>Para configurar una contraseña que expire cada 60 días, avisar con 10 días de anticipación y no permitir que se cambie en menos de 5 días:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>chage<span class="w"> </span>-M<span class="w"> </span><span class="m">60</span><span class="w"> </span>-W<span class="w"> </span><span class="m">10</span><span class="w"> </span>-m<span class="w"> </span><span class="m">5</span><span class="w"> </span>usuario
</code></pre></div>
<ul>
<li>
<p>Para desactivar la cuenta de un usuario en una fecha específica:
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>chage<span class="w"> </span>-E<span class="w"> </span><span class="m">2024</span>-12-31<span class="w"> </span>usuario
</code></pre></div></p>
</li>
<li>
<p>Para obligar al usuario a cambiar su contraseña en su próximo inicio de sesión, se utiliza <strong>chage -d 0 usuario</strong>.
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>chage<span class="w"> </span>-d<span class="w"> </span><span class="m">0</span><span class="w"> </span>-m<span class="w"> </span><span class="m">7</span><span class="w"> </span>-M<span class="w"> </span><span class="m">30</span><span class="w"> </span>-W<span class="w"> </span><span class="m">7</span><span class="w"> </span>usuario
</code></pre></div></p>
</li>
<li>
<p>Para comprobar los cambios se puede ejecutar:</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>sudo<span class="w"> </span>chage<span class="w"> </span>-l<span class="w"> </span>usuario
</code></pre></div>







  
  



  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2023-2024 Francisco Javier Hernández Illán - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="mailto:<fj.hernandez@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48H48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0L0 176z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/fjavier-hernandez-illan" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  




  


<h4>Consentimiento de cookie</h4>
<p>Esta página de apuntes utiliza cookies para reconocer las visitas, medir la efectividad de la documentación y averiguar si encuentras aquello que buscas o cómo has llegado a estos apuntes. Con tu consentimiento, me ayudas a mejorar estos materiales.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Aceptar</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Gestionar cookies</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["header.autohide", "toc.integrate", "navigation.indexes", "navigation.top", "navigation.tracking", "toc.follow", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>